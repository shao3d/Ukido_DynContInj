# Ukido AI Assistant v0.13.5 - Production-Ready MVP —Å —é–º–æ—Ä–æ–º –ñ–≤–∞–Ω–µ—Ü–∫–æ–≥–æ

## ‚úÖ –°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ production!
**–í—Å–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã (06.01.2025)**

### –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∑–∞—â–∏—Ç—ã:
1. ‚úÖ **HTTP Timeout** - 30 —Å–µ–∫—É–Ω–¥ —Ç–∞–π–º–∞—É—Ç –≤ openrouter_client.py
2. ‚úÖ **–ü—Ä–æ–≤–µ—Ä–∫–∞ API –∫–ª—é—á–∞** - –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ —Å sys.exit(1)
3. ‚úÖ **–ü–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–π** - –ø–æ–ª–Ω–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ/–≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ user_signal

## ‚ö° Quick Start (30 —Å–µ–∫—É–Ω–¥)

```bash
# 1. –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞
python src/main.py
# ‚úÖ –î–æ–ª–∂–Ω–æ –±—ã—Ç—å: "üé≠ –°–∏—Å—Ç–µ–º–∞ —é–º–æ—Ä–∞ –ñ–≤–∞–Ω–µ—Ü–∫–æ–≥–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ (–≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å: 80.0%)"

# 2. –ë—ã—Å—Ç—Ä—ã–π —Ç–µ—Å—Ç
python http_sandbox_universal.py dialog_v2_1  # –ü–æ–ª–Ω—ã–π –¥–∏–∞–ª–æ–≥
# –∏–ª–∏
curl -X POST http://localhost:8000/chat -H "Content-Type: application/json" \
  -d '{"user_id":"test","message":"–ü—Ä–∏–≤–µ—Ç! –†–∞—Å—Å–∫–∞–∂–∏—Ç–µ –æ —à–∫–æ–ª–µ"}'
```

### API Endpoints:
- `POST /chat` - –æ—Å–Ω–æ–≤–Ω–æ–π endpoint
  - Request: `{"user_id": "string", "message": "string"}`
  - Response: `{"response": "string", "intent": "string", "user_signal": "string", "humor_generated": bool}`
- `GET /health` - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ —Å–µ—Ä–≤–µ—Ä–∞

## üîê –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –æ–∫—Ä—É–∂–µ–Ω–∏—è

### –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:
```bash
OPENROUTER_API_KEY=sk-or-v1-xxxxx  # –ë–µ–∑ —ç—Ç–æ–≥–æ —Å–µ—Ä–≤–µ—Ä –Ω–µ –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è!
```

### –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:
```bash
MODEL_ANSWER=anthropic/claude-3.5-haiku  # –ú–æ–¥–µ–ª—å –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: gpt-4o-mini)
DETERMINISTIC_MODE=false                  # true –¥–ª—è –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º—ã—Ö —Ç–µ—Å—Ç–æ–≤
LOG_LEVEL=INFO                           # INFO –∏–ª–∏ DEBUG –¥–ª—è –¥–µ—Ç–∞–ª—å–Ω–æ–π –æ—Ç–ª–∞–¥–∫–∏
```

### –°–æ–∑–¥–∞–Ω–∏–µ .env —Ñ–∞–π–ª–∞:
```bash
cp .env.example .env
# –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ .env –∏ –¥–æ–±–∞–≤—å—Ç–µ –≤–∞—à OPENROUTER_API_KEY
```

## üìã –ü—Ä–∏–º–µ—Ä—ã API –∑–∞–ø—Ä–æ—Å–æ–≤

### –¢–∏–ø–∏—á–Ω—ã–π –¥–∏–∞–ª–æ–≥ —Å —Ç—Ä–µ–≤–æ–∂–Ω—ã–º —Ä–æ–¥–∏—Ç–µ–ª–µ–º:
```json
// –ó–∞–ø—Ä–æ—Å:
POST /chat
{
  "user_id": "parent_456",
  "message": "–£ –º–µ–Ω—è –¥–≤–æ–µ –¥–µ—Ç–µ–π, –º–ª–∞–¥—à–∏–π –æ—á–µ–Ω—å —Å—Ç–µ—Å–Ω–∏—Ç–µ–ª—å–Ω—ã–π, –±–æ–∏—Ç—Å—è –∫–∞–º–µ—Ä—ã"
}

// –û—Ç–≤–µ—Ç:
{
  "response": "–ú–Ω–æ–≥–∏–µ —Ä–æ–¥–∏—Ç–µ–ª–∏ —Å—Ç–∞–ª–∫–∏–≤–∞—é—Ç—Å—è —Å —Ç–µ–º, —á—Ç–æ –¥–µ—Ç–∏ —Å—Ç–µ—Å–Ω—è—é—Ç—Å—è –∫–∞–º–µ—Ä—ã. –í –Ω–∞—à–µ–π —à–∫–æ–ª–µ –ø–µ–¥–∞–≥–æ–≥–∏ –∏–º–µ—é—Ç –ø—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–æ–µ –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –∏ –∑–Ω–∞—é—Ç, –∫–∞–∫ –ø–æ–º–æ—á—å —Å—Ç–µ—Å–Ω–∏—Ç–µ–ª—å–Ω—ã–º –¥–µ—Ç—è–º. –ù–∞—á–∏–Ω–∞–µ–º —Å –∏–≥—Ä–æ–≤—ã—Ö —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π –±–µ–∑ –≤–∫–ª—é—á—ë–Ω–Ω–æ–π –∫–∞–º–µ—Ä—ã, –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ —Å–æ–∑–¥–∞—ë–º –∫–æ–º—Ñ–æ—Ä—Ç–Ω—É—é –∞—Ç–º–æ—Å—Ñ–µ—Ä—É...",
  "intent": "success",
  "user_signal": "anxiety_about_child",
  "relevant_documents": ["methodology.md", "teachers_team.md"],
  "metadata": {
    "cta_added": false,
    "cta_blocked": true,
    "block_reason": "anxiety_signal"
  },
  "humor_generated": false
}
```

### –ü—Ä–∏–º–µ—Ä —Å —é–º–æ—Ä–æ–º –ñ–≤–∞–Ω–µ—Ü–∫–æ–≥–æ (offtopic):
```json
// –ó–∞–ø—Ä–æ—Å:
POST /chat
{
  "user_id": "test_user",
  "message": "–ê —É –≤–∞—Å –µ—Å—Ç—å –ø–∞—Ä–∫–æ–≤–∫–∞?"
}

// –û—Ç–≤–µ—Ç:
{
  "response": "–ü–∞—Ä–∫–æ–≤–∫–∞ —É –Ω–∞—Å –∫–∞–∫ —É –≤—Å–µ—Ö - –µ—Å—Ç—å, –Ω–æ –∑–∞–Ω—è—Ç–∞. –ü—è—Ç—å –º–µ—Å—Ç –±–µ—Å–ø–ª–∞—Ç–Ω—ã—Ö, –∏ –≤—Å–µ –ø—è—Ç—å –∑–∞–Ω—è—Ç—ã —Å —É—Ç—Ä–∞ —Ç–µ–º–∏, –∫—Ç–æ –ø—Ä–∏–µ—Ö–∞–ª –∑–∞–ø–∏—Å—ã–≤–∞—Ç—å –¥–µ—Ç–µ–π. –ê –º—ã-—Ç–æ –æ–Ω–ª–∞–π–Ω —Ä–∞–±–æ—Ç–∞–µ–º! –í–æ—Ç —Ç–∞–∫–æ–π –ø–∞—Ä–∞–¥–æ–∫—Å. –ü—Ä–∏–µ–∑–∂–∞—é—Ç, –ø–∞—Ä–∫—É—é—Ç—Å—è, —á—Ç–æ–±—ã —É–∑–Ω–∞—Ç—å, —á—Ç–æ –µ—Ö–∞—Ç—å –Ω–µ –Ω–∞–¥–æ.",
  "intent": "offtopic",
  "user_signal": "exploring_only",
  "humor_generated": true
}
```

## üéØ –û –ø—Ä–æ–µ–∫—Ç–µ

**–ß—Ç–æ:** AI-—á–∞—Ç–±–æ—Ç –¥–ª—è –¥–µ—Ç—Å–∫–æ–π –æ–Ω–ª–∞–π–Ω-—à–∫–æ–ª—ã soft skills Ukido  
**–î–ª—è –∫–æ–≥–æ:** –†–æ–¥–∏—Ç–µ–ª–∏ –¥–µ—Ç–µ–π 7-14 –ª–µ—Ç –∏–∑ –£–∫—Ä–∞–∏–Ω—ã  
**–§–æ—Ä–º–∞—Ç:** 100% –æ–Ω–ª–∞–π–Ω —á–µ—Ä–µ–∑ Zoom, –æ—Ñ–∏—Å –≤ –ö–∏–µ–≤–µ —Ç–æ–ª—å–∫–æ –¥–ª—è –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–π  
**–ö–ª—é—á:** –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã –ø–æ–¥ —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ä–æ–¥–∏—Ç–µ–ª—è

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ Pipeline

```
USER MESSAGE ‚Üí [ROUTER] ‚Üí [ORCHESTRATOR] ‚Üí [GENERATOR/HUMOR] ‚Üí RESPONSE
```

### Data Flow (—É–ø—Ä–æ—â—ë–Ω–Ω—ã–π):

#### 1Ô∏è‚É£ **ROUTER** (Gemini 2.5 Flash) - –ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ç–æ—Ä –Ω–∞–º–µ—Ä–µ–Ω–∏–π
- **–û–ø—Ä–µ–¥–µ–ª—è–µ—Ç:** intent (success/offtopic), user_signal (—ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ)
- **–ü–æ–¥–±–∏—Ä–∞–µ—Ç –¥–æ–∫—É–º–µ–Ω—Ç—ã:** —á–µ—Ä–µ–∑ trigger_words –∏–∑ summaries.json  
- **–î–µ–∫–æ–º–ø–æ–∑–∏—Ä—É–µ—Ç:** —Å–ª–æ–∂–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã –Ω–∞ –∞—Ç–æ–º–∞—Ä–Ω—ã–µ

#### 2Ô∏è‚É£ **ORCHESTRATOR** (main.py) - –¶–µ–Ω—Ç—Ä –ø—Ä–∏–Ω—è—Ç–∏—è —Ä–µ—à–µ–Ω–∏–π
- **–°–æ—Ö—Ä–∞–Ω—è–µ—Ç:** –∏—Å—Ç–æ—Ä–∏—é (LRU 1000 users √ó 10 msgs), —Å–æ—Å—Ç–æ—è–Ω–∏—è
- **–§–∏–ª—å—Ç—Ä—É–µ—Ç:** offtopic –∏–∑ –∏—Å—Ç–æ—Ä–∏–∏ –ø–µ—Ä–µ–¥ Claude  
- **–ú–∞—Ä—à—Ä—É—Ç–∏–∑–∏—Ä—É–µ—Ç:**
  - `success` ‚Üí Generator (Claude) 
  - `offtopic` ‚Üí –Æ–º–æ—Ä (80%) –∏–ª–∏ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ —Ñ—Ä–∞–∑—ã
  - `need_simplification` ‚Üí –ü—Ä–æ—Å—å–±–∞ —É–ø—Ä–æ—Å—Ç–∏—Ç—å

#### 3Ô∏è‚É£ **GENERATOR** (Claude 3.5 Haiku) - –°–æ–∑–¥–∞–Ω–∏–µ –æ—Ç–≤–µ—Ç–æ–≤
- **–ó–∞–≥—Ä—É–∂–∞–µ—Ç:** –¥–æ–∫—É–º–µ–Ω—Ç—ã –∏–∑ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π
- **–ê–¥–∞–ø—Ç–∏—Ä—É–µ—Ç —Ç–æ–Ω:** –ø–æ–¥ user_signal (–¥–µ–ª–æ–≤–æ–π/—ç–º–ø–∞—Ç–∏—á–Ω—ã–π/—Ü–µ–Ω–Ω–æ—Å—Ç–Ω—ã–π)
- **–û—Ä–≥–∞–Ω–∏—á–Ω–æ –≤—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç CTA:** —Å rate limiting 1/2 —Å–æ–æ–±—â–µ–Ω–∏–π
- **–ü–æ—Å—Ç–ø—Ä–æ—Ü–µ—Å—Å–∏–Ω–≥:** –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è, —á–∏—Å—Ç–∫–∞ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤

#### 4Ô∏è‚É£ **HUMOR ENGINE** - –Æ–º–æ—Ä –ñ–≤–∞–Ω–µ—Ü–∫–æ–≥–æ –¥–ª—è offtopic
- **–ë–ª–æ–∫–∏—Ä–æ–≤–∫–∏:** anxiety, price_sensitive, —á–∏—Å—Ç—ã–µ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è
- **Rate limiting:** max 5 —à—É—Ç–æ–∫/—á–∞—Å –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è  
- **–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å:** 80% –¥–ª—è offtopic (—É–≤–µ–ª–∏—á–µ–Ω–æ –¥–ª—è –¥–µ–º–æ)
- **Fallback:** —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –ø–µ—Ä–µ–∞–¥—Ä–µ—Å—É—é—â–∏–µ —Ñ—Ä–∞–∑—ã

## üìä State Machine

### 4 User Signals (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –ø–æ —É–±—ã–≤–∞–Ω–∏—é):

| Signal | –¢—Ä–∏–≥–≥–µ—Ä—ã | –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∏ | Tone | CTA |
|--------|----------|------------|------|-----|
| **ready_to_buy** | "–∑–∞–ø–∏—à–∏—Ç–µ", < 5 —Å–ª–æ–≤ | - | –î–µ–ª–æ–≤–æ–π, –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π | –í—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç |
| **anxiety_about_child** | "–±–æ–∏—Ç—Å—è", "–ø–ª–∞—á–µ—Ç" | üö´ –Æ–º–æ—Ä | –≠–º–ø–∞—Ç–∏—á–Ω—ã–π, "–ú–Ω–æ–≥–∏–µ —Ä–æ–¥–∏—Ç–µ–ª–∏..." | –°—Ä–µ–¥–Ω–∏–π |
| **price_sensitive** | "–¥–æ—Ä–æ–≥–æ", –∂–∞–ª–æ–±—ã –Ω–∞ —Ü–µ–Ω—É | üö´ –Æ–º–æ—Ä, –∏–Ω–µ—Ä—Ü–∏—è 85% | –ü–æ–¥—á—ë—Ä–∫–∏–≤–∞—Ç—å —Ü–µ–Ω–Ω–æ—Å—Ç—å | –ù–∏–∑–∫–∏–π |
| **exploring_only** | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é | - | –î—Ä—É–∂–µ–ª—é–±–Ω—ã–π | –°—Ä–µ–¥–Ω–∏–π |

### –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø–µ—Ä–µ—Ö–æ–¥—ã —Å–∏–≥–Ω–∞–ª–æ–≤:

- `exploring ‚Üí anxiety`: –ø—Ä–∏ —Å–ª–æ–≤–∞—Ö "–±–æ–∏—Ç—Å—è", "—Å—Ç–µ—Å–Ω–∏—Ç–µ–ª—å–Ω—ã–π", "–ø–ª–∞—á–µ—Ç"
- `exploring ‚Üí ready_to_buy`: –ø—Ä–∏ "–∑–∞–ø–∏—à–∏—Ç–µ", "—Ö–æ—á—É –∑–∞–ø–∏—Å–∞—Ç—å"  
- `exploring ‚Üí price_sensitive`: –ø—Ä–∏ –∂–∞–ª–æ–±–∞—Ö –Ω–∞ —Ü–µ–Ω—É
- `price_sensitive ‚Üí ready_to_buy`: –¢–û–õ–¨–ö–û –ø—Ä–∏ —è–≤–Ω–æ–º –ø—Ä–∏–Ω—è—Ç–∏–∏ ("–ª–∞–¥–Ω–æ, –∑–∞–ø–∏—à–∏—Ç–µ")
- `anxiety ‚Üí exploring`: —Ä–µ–¥–∫–æ, –ø—Ä–∏ —Å–º–µ–Ω–µ —Ç–µ–º—ã
- **‚ö†Ô∏è –í–ê–ñ–ù–û**: –ò–Ω–µ—Ä—Ü–∏—è 85% –¥–ª—è price_sensitive –ù–ï —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞! –°–∏–≥–Ω–∞–ª –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –∑–∞–Ω–æ–≤–æ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è

### Intent Types:

- **success** ‚Üí Generator —Å–æ–∑–¥–∞—ë—Ç –æ—Ç–≤–µ—Ç –∏–∑ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
- **offtopic** ‚Üí –Æ–º–æ—Ä (~57% —Ä–µ–∞–ª—å–Ω–æ, 80% –±–∞–∑–æ–≤–∞—è) –∏–ª–∏ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è —Ñ—Ä–∞–∑–∞  
- **need_simplification** ‚Üí –ü—Ä–æ—Å—å–±–∞ —É–ø—Ä–æ—Å—Ç–∏—Ç—å –≤–æ–ø—Ä–æ—Å (4+ –≤–æ–ø—Ä–æ—Å–∞)

## üîê –ö–ª—é—á–µ–≤—ã–µ –∞–ª–≥–æ—Ä–∏—Ç–º—ã

### –í—ã–±–æ—Ä –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –≤ Router:
```python
# router.py –∏—Å–ø–æ–ª—å–∑—É–µ—Ç trigger_words –∏–∑ summaries.json
for word in message.lower().split():
    for doc, metadata in summaries.items():
        if word in metadata["trigger_words"]:
            relevant_docs.add(doc)
return list(relevant_docs)[:4]  # –ú–∞–∫—Å–∏–º—É–º 4
```

### Filter Offtopic (main.py:189-228):
```python
def filter_offtopic_from_history(history):
    filtered = []
    for msg in history:
        # –ü—Ä–æ–ø—É—Å–∫–∞–µ–º offtopic —Å–æ–æ–±—â–µ–Ω–∏—è
        if msg.get("metadata", {}).get("intent") != "offtopic":
            filtered.append(msg)
    return filtered[-10:]  # –ú–∞–∫—Å–∏–º—É–º 10 —Å–æ–æ–±—â–µ–Ω–∏–π
```

### CTA Rate Limiting (offers_catalog.py):
```python
last_cta_position[user_id] = message_count
# CTA –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –µ—Å–ª–∏:
# - –ü—Ä–æ—à–ª–æ –º–∏–Ω–∏–º—É–º 2 —Å–æ–æ–±—â–µ–Ω–∏—è —Å –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ CTA
# - –ü–æ–¥—Ö–æ–¥—è—â–∏–π user_signal –¥–ª—è CTA
```

## üîß –ö–ª—é—á–µ–≤—ã–µ –∑–∞—â–∏—Ç–Ω—ã–µ –º–µ—Ö–∞–Ω–∏–∑–º—ã

### 1. HTTP Timeout Protection (openrouter_client.py:59)
```python
async with httpx.AsyncClient(timeout=30.0) as client:
    # –ó–∞—â–∏—Ç–∞ –æ—Ç –∑–∞–≤–∏—Å—à–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
```

### 2. API Key Validation (main.py:44-48)  
```python
if not config.OPENROUTER_API_KEY:
    print("‚ùå –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –û–®–ò–ë–ö–ê: –ù–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω OPENROUTER_API_KEY!")
    sys.exit(1)  # –ù–µ –∑–∞–ø—É—Å–∫–∞–µ–º—Å—è –±–µ–∑ –∫–ª—é—á–∞
```

### 3. State Persistence (persistence_manager.py)
```python
# –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
state_snapshot = create_state_snapshot(history, user_signals_history, social_state, user_id)
persistence_manager.save_state(user_id, state_snapshot)
```

## üî© –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã

### SimpleCTABlocker (simple_cta_blocker.py)
–ò–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ CTA (–ø—Ä–∏–∑—ã–≤–æ–≤ –∫ –¥–µ–π—Å—Ç–≤–∏—é):
- **–û—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç –æ—Ç–∫–∞–∑—ã**: "–Ω–µ –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ", "–¥–æ—Ä–æ–≥–æ", "–Ω–µ –Ω–∞–¥–æ" ‚Üí –±–ª–æ–∫–∏—Ä—É–µ—Ç CTA –Ω–∞ 5 —Å–æ–æ–±—â–µ–Ω–∏–π
- **–†–∞—Å–ø–æ–∑–Ω–∞—ë—Ç –∑–∞–≤–µ—Ä—à—ë–Ω–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è**: "—É–∂–µ –æ–ø–ª–∞—Ç–∏–ª", "–∑–∞–ø–∏—Å–∞–ª–∏—Å—å" ‚Üí –±–ª–æ–∫–∏—Ä—É–µ—Ç CTA –Ω–∞–≤—Å–µ–≥–¥–∞  
- **Rate limiting**: CTA –Ω–µ —á–∞—â–µ —á–µ–º —Ä–∞–∑ –≤ 2 —Å–æ–æ–±—â–µ–Ω–∏—è
- **–ê–¥–∞–ø—Ç–∏–≤–Ω–∞—è —á–∞—Å—Ç–æ—Ç–∞**: —É–º–µ–Ω—å—à–∞–µ—Ç —á–∞—Å—Ç–æ—Ç—É –ø–æ—Å–ª–µ –æ—Ç–∫–∞–∑–æ–≤

```python
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ main.py:
should_block_cta, block_reason = simple_cta_blocker.should_block_cta(
    user_id, message_count, user_signal
)
```

### –°–∏—Å—Ç–µ–º–∞ —é–º–æ—Ä–∞ –ñ–≤–∞–Ω–µ—Ü–∫–æ–≥–æ (3 –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞)
**1. zhvanetsky_humor.py** - –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä —é–º–æ—Ä–∞ —á–µ—Ä–µ–∑ Claude:
- –°–æ–∑–¥–∞—ë—Ç —é–º–æ—Ä –≤ —Å—Ç–∏–ª–µ –ñ–≤–∞–Ω–µ—Ü–∫–æ–≥–æ –¥–ª—è offtopic —Å–æ–æ–±—â–µ–Ω–∏–π
- –ê–¥–∞–ø—Ç–∏—Ä—É–µ—Ç—Å—è –∫ –∫–æ–Ω—Ç–µ–∫—Å—Ç—É –∏ –∏—Å—Ç–æ—Ä–∏–∏ –¥–∏–∞–ª–æ–≥–∞
- –ù–∞—Å—Ç—Ä–æ–π–∫–∏: temperature=1.0, max_tokens=150

**2. zhvanetsky_safety.py** - –°–∏—Å—Ç–µ–º–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏:
- **–ë–ª–æ–∫–∏—Ä—É–µ—Ç —é–º–æ—Ä –ø—Ä–∏**: anxiety_about_child, price_sensitive —Å–∏–≥–Ω–∞–ª–∞—Ö
- **Rate limiting**: –º–∞–∫—Å–∏–º—É–º 5 —à—É—Ç–æ–∫ –≤ —á–∞—Å –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- **–í–∞–ª–∏–¥–∞—Ü–∏—è**: –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–ª–∏–Ω—ã (max 600 —Å–∏–º–≤–æ–ª–æ–≤), –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –≥—Ä—É–±–æ—Å—Ç–∏
- **–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å**: –±–∞–∑–æ–≤–∞—è 80% —Å –º–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä–∞–º–∏ –ø–æ user_signal

**3. zhvanetsky_golden.py** - –≠—Ç–∞–ª–æ–Ω–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã:
- –ë–∞–∑–∞ –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã—Ö —à—É—Ç–æ–∫ –¥–ª—è –æ–±—É—á–µ–Ω–∏—è –º–æ–¥–µ–ª–∏
- –ü—Ä–∏–º–µ—Ä—ã –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ —Å—Ç–∏–ª—è –∏ —Ç–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏

### –ü–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å (persistence_manager.py)
–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–π:
- **–§–æ—Ä–º–∞—Ç**: JSON —Ñ–∞–π–ª—ã –≤ `data/persistent_states/{user_id}.json`
- **TTL**: –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ —Ñ–∞–π–ª–æ–≤ —Å—Ç–∞—Ä—à–µ 7 –¥–Ω–µ–π
- **–õ–∏–º–∏—Ç**: –º–∞–∫—Å–∏–º—É–º 10,000 —Ñ–∞–π–ª–æ–≤ (LRU –æ—á–∏—Å—Ç–∫–∞)
- **Graceful shutdown**: —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤—Å–µ—Ö –∞–∫—Ç–∏–≤–Ω—ã—Ö —Å–æ—Å—Ç–æ—è–Ω–∏–π –ø—Ä–∏ –æ—Å—Ç–∞–Ω–æ–≤–∫–µ

```json
// –§–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è:
{
  "history": [...],              // –ü–æ—Å–ª–µ–¥–Ω–∏–µ 10 —Å–æ–æ–±—â–µ–Ω–∏–π
  "user_signal": "exploring_only", // –¢–µ–∫—É—â–∏–π —Å–∏–≥–Ω–∞–ª
  "greeting_exchanged": true,      // –§–ª–∞–≥ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è
  "message_count": 5,             // –°—á—ë—Ç—á–∏–∫ —Å–æ–æ–±—â–µ–Ω–∏–π
  "last_updated": "2025-01-06T12:00:00Z"
}
```

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
src/
‚îú‚îÄ‚îÄ main.py                 # –û—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä + HOTFIX user_signal + –ø–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å
‚îú‚îÄ‚îÄ config.py               # ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã: –º–æ–¥–µ–ª–∏, —Ç–∞–π–º–∞—É—Ç—ã, –ª–∏–º–∏—Ç—ã
‚îú‚îÄ‚îÄ router.py               # Gemini —Ä–æ—É—Ç–µ—Ä (600+ —Å—Ç—Ä–æ–∫ –ø—Ä–æ–º–ø—Ç–∞!)
‚îú‚îÄ‚îÄ response_generator.py   # Claude –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä + –ø–æ—Å—Ç–ø—Ä–æ—Ü–µ—Å—Å–∏–Ω–≥
‚îú‚îÄ‚îÄ openrouter_client.py    # HTTP –∫–ª–∏–µ–Ω—Ç —Å timeout=30s –∑–∞—â–∏—Ç–æ–π (—Å—Ç—Ä–æ–∫–∞ 59)
‚îú‚îÄ‚îÄ persistence_manager.py  # üÜï –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ/–≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–π –≤ JSON
‚îú‚îÄ‚îÄ zhvanetsky_humor.py     # –Æ–º–æ—Ä —Å –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞–º–∏
‚îú‚îÄ‚îÄ zhvanetsky_safety.py    # SafetyChecker: –≤–∞–ª–∏–¥–∞—Ü–∏—è —é–º–æ—Ä–∞ (max 600 —Å–∏–º–≤, 5 –ø—Ä–µ–¥–ª)
‚îú‚îÄ‚îÄ simple_cta_blocker.py   # SimpleCTABlocker: –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ CTA –ø—Ä–∏ –æ—Ç–∫–∞–∑–∞—Ö/–æ–ø–ª–∞—Ç–µ
‚îú‚îÄ‚îÄ offers_catalog.py       # CTA —Å rate limiting
‚îú‚îÄ‚îÄ history_manager.py      # HistoryManager (–ù–ï ChatMemoryManager!): LRU 1000 users √ó 10 msgs
‚îú‚îÄ‚îÄ social_state.py         # SocialStateManager: –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è (TTL 12—á - –ø—Ä–∏—á–∏–Ω–∞ –ø–æ–≤—Ç–æ—Ä–æ–≤!)
‚îî‚îÄ‚îÄ gemini_cached_client.py # GeminiCachedClient: –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ –ø—Ä–æ–º–ø—Ç–∞

data/
‚îú‚îÄ‚îÄ persistent_states/      # üÜï JSON —Ñ–∞–π–ª—ã —Å–æ—Å—Ç–æ—è–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
‚îú‚îÄ‚îÄ documents_compressed/   # 13 –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –∑–Ω–∞–Ω–∏–π (—Å–∂–∞—Ç—ã–µ –¥–ª—è –ø—Ä–æ–º–ø—Ç–∞)
‚îÇ   ‚îú‚îÄ‚îÄ conditions.md      # ‚≠ê –õ–û–ö–ê–¶–ò–Ø: –æ—Ñ–∏—Å –ö–∏–µ–≤, –ø–∞—Ä–∫–æ–≤–∫–∞, —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ, —Ç–µ—Ö—Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ pricing.md         # –¶–µ–Ω—ã: 7000-8000 –≥—Ä–Ω/–º–µ—Å, —Å–∫–∏–¥–∫–∏, —Ä–∞—Å—Å—Ä–æ—á–∫–∞
‚îÇ   ‚îú‚îÄ‚îÄ methodology.md     # –ò–≥—Ä–æ–≤–∞—è –º–µ—Ç–æ–¥–∏–∫–∞, soft skills, –≤–æ–∑—Ä–∞—Å—Ç–Ω—ã–µ –≥—Ä—É–ø–ø—ã
‚îÇ   ‚îú‚îÄ‚îÄ faq.md            # –ß–∞—Å—Ç—ã–µ –≤–æ–ø—Ä–æ—Å—ã —Ä–æ–¥–∏—Ç–µ–ª–µ–π
‚îÇ   ‚îú‚îÄ‚îÄ courses_detailed.md # 4 –∫—É—Ä—Å–∞: –≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –ö–æ–º–ø–∞—Å, –ö–∞–ø–∏—Ç–∞–Ω –ü—Ä–æ–µ–∫—Ç–æ–≤ –∏ –¥—Ä.
‚îÇ   ‚îú‚îÄ‚îÄ teachers_team.md  # –ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª–∏ —Å –ø—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–º –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ–º
‚îÇ   ‚îî‚îÄ‚îÄ [–µ—â—ë 7 —Ñ–∞–π–ª–æ–≤]    # –†–µ–∑—É–ª—å—Ç–∞—Ç—ã, –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å, ROI, –ø–∞—Ä—Ç–Ω—ë—Ä—ã –∏ –¥—Ä.
‚îî‚îÄ‚îÄ summaries.json         # –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –¥–ª—è Router: trigger_words, typical_questions
    –°—Ç—Ä—É–∫—Ç—É—Ä–∞:
    {
      "conditions.md": {
        "trigger_words": ["—Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ", "–ø–∞—Ä–∫–æ–≤–∫–∞", "–∞–¥—Ä–µ—Å", "–æ—Ñ–∏—Å", "–º–µ—Ç—Ä–æ"],
        "typical_questions": ["–ì–¥–µ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –æ—Ñ–∏—Å?", "–ï—Å—Ç—å –ª–∏ –ø–∞—Ä–∫–æ–≤–∫–∞?"]
      }
    }

tests/
‚îú‚îÄ‚îÄ personas/              # üÜï –¢–µ—Å—Ç–æ–≤—ã–µ –ø–µ—Ä—Å–æ–Ω—ã –∏ —Ä–∞–Ω–Ω–µ—Ä—ã
‚îÇ   ‚îú‚îÄ‚îÄ run_*.py          # –†–∞–Ω–Ω–µ—Ä—ã –¥–ª—è –∫–∞–∂–¥–æ–π –ø–µ—Ä—Å–æ–Ω—ã
‚îÇ   ‚îî‚îÄ‚îÄ test_*.json       # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –ø–µ—Ä—Å–æ–Ω
‚îú‚îÄ‚îÄ runners/              # –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–µ —Ç–µ—Å—Ç–æ–≤—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã
‚îî‚îÄ‚îÄ reports/              # –û—Ç—á—ë—Ç—ã –æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏

test_results/              # –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø—Ä–æ–≥–æ–Ω–æ–≤ —Ç–µ—Å—Ç–æ–≤ (98+ —Ñ–∞–π–ª–æ–≤)

# –í –∫–æ—Ä–Ω–µ –æ—Å—Ç–∞–ª–∏—Å—å —Ç–æ–ª—å–∫–æ –æ—Å–Ω–æ–≤–Ω—ã–µ —Ç–µ—Å—Ç–æ–≤—ã–µ —Ñ–∞–π–ª—ã:
test_dialogues_v2.json     # 10 —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∏–∞–ª–æ–≥–æ–≤  
http_sandbox_universal.py  # –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è –ø–µ—Å–æ—á–Ω–∏—Ü–∞
http_sandbox_simple.py     # –ü—Ä–æ—Å—Ç—ã–µ —Ç–µ—Å—Ç—ã

# –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞–ø–∫–∏ (–Ω–µ –∫—Ä–∏—Ç–∏—á–Ω—ã –¥–ª—è MVP):
docs/                      # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞, –¥–∏–∞–≥—Ä–∞–º–º—ã, –ø–ª–∞–Ω—ã
archive/                   # –ê—Ä—Ö–∏–≤–Ω—ã–µ –≤–µ—Ä—Å–∏–∏ –∫–æ–¥–∞ –∏ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
tools/                     # –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã –∞–Ω–∞–ª–∏–∑–∞
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã:

| –°–∫—Ä–∏–ø—Ç | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ | –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ |
|--------|------------|---------------|
| `http_sandbox_universal.py` | –ü–æ–ª–Ω—ã–µ –¥–∏–∞–ª–æ–≥–∏ | `python http_sandbox_universal.py dialog_v2_1` |
| `http_sandbox_simple.py` | –°—Ç–∞—Ä—ã–µ —Ç–µ—Å—Ç—ã | `python http_sandbox_simple.py dialog_5` |
| `tests/personas/run_*.py` | –¢–µ—Å—Ç—ã –ø–µ—Ä—Å–æ–Ω | `python tests/personas/run_funny_dad_test.py` |
| `curl` | –û–¥–∏–Ω–æ—á–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã | –°–º. Quick Start |

### –ö–ª—é—á–µ–≤—ã–µ —Ç–µ—Å—Ç-–∫–µ–π—Å—ã:

**–í test_dialogues_v2.json:**
1. **dialog_v2_1** - –ú–∞–º–∞-–º–µ—Ç–æ–¥–∏—Å—Ç (exploring ‚Üí ready_to_buy, –ø–∞—Ä–∫–æ–≤–∫–∞)
2. **dialog_v2_3** - –¢—Ä–µ–≤–æ–∂–Ω–∞—è –±–∞–±—É—à–∫–∞ (anxiety, –±–µ–∑ —é–º–æ—Ä–∞)
3. **dialog_v2_4** - –°–∫–µ–ø—Ç–∏–∫-—ç–∫–æ–Ω–æ–º (price_sensitive, –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞)
4. **dialog_v2_10** - –≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –∫–∞—á–µ–ª–∏ (–ø–µ—Ä–µ—Ö–æ–¥—ã —Å–∏–≥–Ω–∞–ª–æ–≤)

**–í tests/personas/ (–∑–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ run_*.py):**
5. **burned_mom** - –ú–∞–º–∞ —Å –Ω–µ–≥–∞—Ç–∏–≤–Ω—ã–º –æ–ø—ã—Ç–æ–º (–≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–æ–≤–µ—Ä–∏—è)
6. **comparing_dad** - –ü–∞–ø–∞-–∞–Ω–∞–ª–∏—Ç–∏–∫ (–º–µ—Ç–æ–¥–∏—á–Ω–æ–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ —à–∫–æ–ª)
7. **funny_it_dad** - IT-–ø–∞–ø–∞ —Å —é–º–æ—Ä–æ–º (—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —é–º–æ—Ä–∞ –ñ–≤–∞–Ω–µ—Ü–∫–æ–≥–æ)
8. **grandmother_skeptic** - –°–∫–µ–ø—Ç–∏—á–Ω–∞—è –±–∞–±—É—à–∫–∞ (anxiety –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏)

## üîç –¢–æ—á–∫–∏ –æ—Ç–ª–∞–¥–∫–∏ —á–∞—Å—Ç—ã—Ö –ø—Ä–æ–±–ª–µ–º

| –ü—Ä–æ–±–ª–µ–º–∞ | –§–∞–π–ª:—Å—Ç—Ä–æ–∫–∞ | –ß—Ç–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å |
|----------|-------------|---------------|
| –Æ–º–æ—Ä –Ω–µ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è | zhvanetsky_safety.py:223 | MAX_LENGTH=600, MAX_SENTENCES=5 |
| CTA –≤—Å–µ–≥–¥–∞ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è | simple_cta_blocker.py:93 | should_block_cta() –ª–æ–≥–∏–∫–∞ |
| –ü–æ–≤—Ç–æ—Ä–Ω—ã–µ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è | social_state.py:37 | has_greeted() —Å TTL=12 —á–∞—Å–æ–≤ |
| –ù–µ–≤–µ—Ä–Ω—ã–π user_signal | main.py:159-179 | HOTFIX —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–∏–≥–Ω–∞–ª–∞ |
| –Æ–º–æ—Ä –¥–ª—è anxiety/price | zhvanetsky_humor.py:85 | check_user_signal() –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ |

## ‚ö†Ô∏è –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ª–∏–º–∏—Ç—ã —Å–∏—Å—Ç–µ–º—ã

- **–Æ–º–æ—Ä:** max 600 —Å–∏–º–≤–æ–ª–æ–≤, 5 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π (–æ–±—Ä–µ–∑–∞–µ—Ç—Å—è –ø—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏!)
- **–ü–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å:** 10,000 —Ñ–∞–π–ª–æ–≤ max, –∞–≤—Ç–æ–æ—á–∏—Å—Ç–∫–∞ —á–µ—Ä–µ–∑ 7 –¥–Ω–µ–π
- **–ò—Å—Ç–æ—Ä–∏—è:** 10 —Å–æ–æ–±—â–µ–Ω–∏–π √ó 1000 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (LRU –∫–µ—à)
- **Social states:** TTL 12 —á–∞—Å–æ–≤ (–ø—Ä–∏—á–∏–Ω–∞ –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–π)
- **CTA rate limit:** 1 CTA –Ω–∞ 2 —Å–æ–æ–±—â–µ–Ω–∏—è –º–∏–Ω–∏–º—É–º

## üìà –ò—Å—Ç–æ—Ä–∏—è –≤–µ—Ä—Å–∏–π

### v0.13.5 (05.09.2025) - Production-ready —Ä–µ–ª–∏–∑, –≤—Å–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã
- **HTTP Timeout —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω**: 30 —Å–µ–∫—É–Ω–¥ —Ç–∞–π–º–∞—É—Ç –≤ openrouter_client.py —Å–æ —Å—Ç—Ä–æ–∫–∏ 59
  - –î–≤–æ–π–Ω–∞—è –∑–∞—â–∏—Ç–∞: –∏ –≤ AsyncClient, –∏ –≤ post –∑–∞–ø—Ä–æ—Å–µ
  - –û–±—Ä–∞–±–æ—Ç–∫–∞ httpx.TimeoutException —Å graceful fallback —Å–æ–æ–±—â–µ–Ω–∏–µ–º
- **–ü—Ä–æ–≤–µ—Ä–∫–∞ API –∫–ª—é—á–∞ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ**: main.py —Å—Ç—Ä–æ–∫–∏ 44-48
  - –ü—Ä–æ–≥—Ä–∞–º–º–∞ –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è —Å sys.exit(1) –µ—Å–ª–∏ –∫–ª—é—á –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç
  - –í—ã–≤–æ–¥–∏—Ç—Å—è –¥–ª–∏–Ω–∞ –∫–ª—é—á–∞ –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
- **–ü–æ–ª–Ω–∞—è –ø–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–π**: persistence_manager.py –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–µ–Ω
  - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ user_signal –≤ create_state_snapshot (—Å—Ç—Ä–æ–∫–∞ 305)
  - –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –≤ restore_state_snapshot (—Å—Ç—Ä–æ–∫–∞ 342)
  - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ main.py: –∑–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ, —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
- **–ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ Gemini —Ä–∞–±–æ—Ç–∞–µ—Ç**: –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è GeminiCachedClient
  - router.py –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç –∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç GeminiCachedClient (—Å—Ç—Ä–æ–∫–∏ 10, 33, 151)
  - –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –¥–ª—è —ç–∫–æ–Ω–æ–º–∏–∏ —Ç–æ–∫–µ–Ω–æ–≤
- **–†–µ–∑—É–ª—å—Ç–∞—Ç**: –°–∏—Å—Ç–µ–º–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤–∞ –∫ production –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!

### v0.13.4 (05.09.2024) - –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —é–º–æ—Ä–∞ –ñ–≤–∞–Ω–µ—Ü–∫–æ–≥–æ –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–π
- **–£–≤–µ–ª–∏—á–µ–Ω–∞ —á–∞—Å—Ç–æ—Ç–∞ —é–º–æ—Ä–∞** —Å 10% –¥–æ 57% –¥–ª—è offtopic —Å–æ–æ–±—â–µ–Ω–∏–π:
  - –ë–∞–∑–æ–≤–∞—è –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å —É–≤–µ–ª–∏—á–µ–Ω–∞: 0.33 ‚Üí 0.80 (config.py)
  - Rate limit —É–≤–µ–ª–∏—á–µ–Ω: 3 ‚Üí 5 —à—É—Ç–æ–∫ –≤ —á–∞—Å
  - –ú–Ω–æ–∂–∏—Ç–µ–ª—å –¥–ª—è exploring_only: 1.2 ‚Üí 1.25
  - –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π cap –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏: 0.85 ‚Üí 0.90
- **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–±–ª–µ–º–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —é–º–æ—Ä–∞**:
  - –û–±–Ω–∞—Ä—É–∂–µ–Ω–æ: —é–º–æ—Ä –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–ª—Å—è, –Ω–æ –æ—Ç–∫–ª–æ–Ω—è–ª—Å—è –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π
  - –õ–∏–º–∏—Ç —Å–∏–º–≤–æ–ª–æ–≤ —É–≤–µ–ª–∏—á–µ–Ω: 400 ‚Üí 600 (zhvanetsky_safety.py:223)
  - –õ–∏–º–∏—Ç –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π: 3 ‚Üí 5 (zhvanetsky_safety.py:227)
  - –î–æ–±–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
- **–£–ª—É—á—à–µ–Ω –ø—Ä–æ–º–ø—Ç –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —é–º–æ—Ä–∞**:
  - –£—Å–∏–ª–µ–Ω—ã —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫—Ä–∞—Ç–∫–æ—Å—Ç–∏ –≤ zhvanetsky_humor.py
  - –î–æ–±–∞–≤–ª–µ–Ω—ã –º–µ—Ç—Ä–∏–∫–∏ –¥–ª–∏–Ω—ã –∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π –≤ –ª–æ–≥–∏
- **–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è**:
  - funny_it_dad: 3 —é–º–æ—Ä–∞ –∏–∑ 7 offtopic (43%)
  - –ü–æ—Å–ª–µ —Ñ–∏–Ω–∞–ª—å–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏: 4 –∏–∑ 7 (57%)
  - –°–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤—Å–µ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ (anxiety, price_sensitive)
- **–£—Ä–æ–∫:** –í–∞–∂–Ω–æ—Å—Ç—å –ø—Ä–æ–≤–µ—Ä–∫–∏ –ª–æ–≥–æ–≤ - –ø—Ä–æ–±–ª–µ–º–∞ –±—ã–ª–∞ –Ω–µ –≤ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏, –∞ –≤ –≤–∞–ª–∏–¥–∞—Ü–∏–∏

### v0.13.0-v0.13.3 (03-04.09.2024) - –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è
- **v0.13.3**: –ö–æ–¥ —Ä–µ–≤—å—é –∏ –ø–ª–∞–Ω –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π (–≤—Å–µ —É–∂–µ –≤—ã–ø–æ–ª–Ω–µ–Ω—ã –≤ v0.13.5)
- **v0.13.2**: –£–Ω–∏—Ñ–∏–∫–∞—Ü–∏—è –¥–æ–º–µ–Ω–æ–≤ –Ω–∞ ukido.com.ua –∏ —É–¥–∞–ª–µ–Ω–∏–µ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤
- **v0.13.1**: –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ä–≥–∞–Ω–∏—á–Ω–æ–π –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ CTA (25% ‚Üí 100%)
- **v0.13.0**: Production-ready –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–º–ø—Ç–æ–≤ (—Å–æ–∫—Ä–∞—â–µ–Ω–∏–µ –Ω–∞ 25%)

### v0.12.x (28.08-02.09.2024) - –°–µ—Ä–∏—è –º–µ–ª–∫–∏—Ö –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π
- **–ü–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å** (v0.12.20): PersistenceManager –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∏–∞–ª–æ–≥–æ–≤ –ø—Ä–∏ —Ä–µ—Å—Ç–∞—Ä—Ç–µ
- **–ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è** (v0.12.25): –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã mixed –∏–Ω—Ç–µ–Ω—Ç—ã ("–ü—Ä–∏–≤–µ—Ç! –†–∞—Å—Å–∫–∞–∂–∏—Ç–µ" ‚Üí success)
- **–î–∞–Ω–Ω—ã–µ** (v0.12.24): –£—Å—Ç—Ä–∞–Ω–µ–Ω—ã –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏—è –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ö (–∏–º—è –º–µ—Ç–æ–¥–∏—Å—Ç–∞)
- **–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç** (v0.12.23): –°–∏—Å—Ç–µ–º–∞ –ø–æ–Ω–∏–º–∞–µ—Ç "–∑–∞–±–∏—Ä–∞—Ç—å –±—É–¥—É" –∏ –ø—Ä–æ—è—Å–Ω–∏—Ç –æ–Ω–ª–∞–π–Ω-—Ñ–æ—Ä–º–∞—Ç
- **CTA –º–∞—Ä–∫–µ—Ä—ã** (v0.12.22): –£–±—Ä–∞–Ω—ã –≤–∏–¥–∏–º—ã–µ HTML –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∏–∑ –æ—Ç–≤–µ—Ç–æ–≤
- **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞** (v0.12.21): –û–∫—Ä—É–≥–ª–µ–Ω–∏–µ —á–∏—Å–µ–ª ("542" ‚Üí "–æ–∫–æ–ª–æ 540")
- **–í–∞—Ä–∏–∞—Ç–∏–≤–Ω–æ—Å—Ç—å** (v0.12.19): –†–∞–∑–Ω–æ–æ–±—Ä–∞–∑–∏–µ —Ñ—Ä–∞–∑ –¥–ª—è price_sensitive
- **–õ–æ–∫–∞—Ü–∏—è** (v0.12.18): –î–æ–±–∞–≤–ª–µ–Ω–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –æ—Ñ–∏—Å–µ –∏ –ø–∞—Ä–∫–æ–≤–∫–µ

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

```python
# src/config.py - –≥–ª–∞–≤–Ω—ã–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ñ–∞–π–ª
MODEL_ROUTER = "google/gemini-2.5-flash"
MODEL_ANSWER = "anthropic/claude-3.5-haiku"  
ZHVANETSKY_PROBABILITY = 0.80  # –í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å —é–º–æ—Ä–∞ (—É–≤–µ–ª–∏—á–µ–Ω–æ –¥–ª—è –¥–µ–º–æ)
MAX_HISTORY_SIZE = 10           # –°–æ–æ–±—â–µ–Ω–∏–π –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
CACHE_SIZE = 1000               # LRU –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
DETERMINISTIC_MODE = False      # True –¥–ª—è –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º–æ—Å—Ç–∏
```

## üö® –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –∏ –ø—Ä–æ–±–ª–µ–º—ã

### –¢–µ–∫—É—â–∏–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è (by design):
1. **–ò–Ω–µ—Ä—Ü–∏—è price_sensitive** - —Å–∏–≥–Ω–∞–ª –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –∫–∞–∂–¥–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è —Ç–æ—á–Ω–æ—Å—Ç–∏
2. **–ü–æ–≤—Ç–æ—Ä–Ω—ã–µ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è —á–µ—Ä–µ–∑ 12—á** - SocialStateManager TTL (social_state.py:37)
3. **–ù–µ—Ç retry –¥–ª—è LLM** - –ø—Ä–∏ —Å–±–æ–µ API –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∞–µ—Ç –æ—à–∏–±–∫—É

### –¢—Ä–µ–±—É—é—Ç –¥–æ—Ä–∞–±–æ—Ç–∫–∏:
1. **–°–≤–µ—Ä—Ö—á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å anxiety** - "—Ä–µ–±—ë–Ω–æ–∫ –¥–æ–≤–µ–¥—ë—Ç" ‚Üí anxiety_about_child  
2. **CTA –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à—ë–Ω–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π** - SimpleCTABlocker –Ω–µ –≤—Å–µ–≥–¥–∞ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç
3. **CTA –ø–æ—Å–ª–µ –æ—Ç–∫–∞–∑–æ–≤** - —á–∞—Å—Ç–∏—á–Ω–æ –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è —á–µ—Ä–µ–∑ HARD_REFUSALS/SOFT_REFUSALS

## üí° Best Practices

### –ü—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏:
1. **–ù–ï —Å–æ–∑–¥–∞–≤–∞–π –Ω–æ–≤—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã** - –¥–æ–±–∞–≤–ª—è–π –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ
2. **–û–±–Ω–æ–≤–ª—è–π summaries.json** - trigger_words –∫—Ä–∏—Ç–∏—á–Ω—ã –¥–ª—è Router
3. **–¢–µ—Å—Ç–∏—Ä—É–π —á–µ—Ä–µ–∑ http_sandbox_universal.py** - –ø–æ–ª–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç

### –ü—Ä–∏ –æ—Ç–ª–∞–¥–∫–µ:
1. **–ü—Ä–æ–≤–µ—Ä—è–π intent –∏ signal** –≤ –æ—Ç–≤–µ—Ç–µ API
2. **–°–º–æ—Ç—Ä–∏ –ª–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞** - —Ç–∞–º –≤–∏–¥–Ω—ã –≤—Å–µ —ç—Ç–∞–ø—ã
3. **–ò—Å–ø–æ–ª—å–∑—É–π DETERMINISTIC_MODE** –¥–ª—è –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º–æ—Å—Ç–∏

### –ü–æ—Å—Ç–ø—Ä–æ—Ü–µ—Å—Å–∏–Ω–≥ vs –ü—Ä–æ–º–ø—Ç—ã:
- **–ò—Å–ø–æ–ª—å–∑—É–π –ø–æ—Å—Ç–ø—Ä–æ—Ü–µ—Å—Å–∏–Ω–≥** –¥–ª—è –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø—Ä–∞–≤–∏–ª
- **–ù–µ –±–æ—Ä–∏—Å—å —Å LLM** - –ø—Ä–æ—â–µ –∏—Å–ø—Ä–∞–≤–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç
- **–ü—Ä–∏–º–µ—Ä:** –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –ø–æ—Å—Ç–ø—Ä–æ—Ü–µ—Å—Å–∏–Ω–≥–æ–º

## üõ†Ô∏è –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –∑–Ω–∞–Ω–∏–π:
1. **–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–¥—Ö–æ–¥—è—â–∏–π –¥–æ–∫—É–º–µ–Ω—Ç** –≤ `data/documents_compressed/`
2. **–î–æ–±–∞–≤—å—Ç–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é** –≤ markdown —Ñ–æ—Ä–º–∞—Ç–µ
3. **–û–±–Ω–æ–≤–∏—Ç–µ summaries.json**:
```json
{
  "your_doc.md": {
    "trigger_words": ["–Ω–æ–≤–æ–µ", "—Å–ª–æ–≤–æ", "—Ç—Ä–∏–≥–≥–µ—Ä"],
    "typical_questions": ["–ö–∞–∫–æ–π —Ç–∏–ø–∏—á–Ω—ã–π –≤–æ–ø—Ä–æ—Å?"],
    "core_topics": ["–û—Å–Ω–æ–≤–Ω–∞—è —Ç–µ–º–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞"]
  }
}
```
4. **–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ**: `python http_sandbox_universal.py`

### –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤—ã—Ö —Ç–µ—Å—Ç–æ–≤—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤:
1. **–û—Ç–∫—Ä–æ–π—Ç–µ** `test_dialogues_v2.json`
2. **–î–æ–±–∞–≤—å—Ç–µ –Ω–æ–≤—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π**:
```json
{
  "scenario_name": {
    "description": "–û–ø–∏—Å–∞–Ω–∏–µ –ø–µ—Ä—Å–æ–Ω—ã",
    "messages": [
      "–ü–µ—Ä–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è",
      "–í—Ç–æ—Ä–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ"
    ],
    "expected_signals": ["exploring_only", "price_sensitive"]
  }
}
```
3. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ**: `python http_sandbox_universal.py scenario_name`

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —é–º–æ—Ä–∞ –ñ–≤–∞–Ω–µ—Ü–∫–æ–≥–æ:
- **–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å**: `config.py` ‚Üí `ZHVANETSKY_PROBABILITY` (0.0-1.0)
- **–ß–∞—Å—Ç–æ—Ç–∞**: `config.py` ‚Üí `ZHVANETSKY_MAX_PER_HOUR` (—à—É—Ç–æ–∫ –≤ —á–∞—Å)
- **–ë–ª–æ–∫–∏—Ä–æ–≤–∫–∏**: `zhvanetsky_safety.py` ‚Üí `BLOCKED_SIGNALS`

## üîç –û—Ç–ª–∞–¥–∫–∞ –∏ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:
```bash
# –í–∫–ª—é—á–∏—Ç—å –¥–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
LOG_LEVEL=DEBUG python src/main.py

# –ö–ª—é—á–µ–≤—ã–µ –º–∞—Ä–∫–µ—Ä—ã –≤ –ª–æ–≥–∞—Ö:
üîç DEBUG Router result    # –†–µ–∑—É–ª—å—Ç–∞—Ç –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏
üíæ –°–æ—Ö—Ä–∞–Ω—ë–Ω user_signal  # –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–∏–≥–Ω–∞–ª–∞
üîß HOTFIX               # –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–∏–≥–Ω–∞–ª–∞
üé≠ Zhvanetsky humor     # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —é–º–æ—Ä–∞
üö´ SimpleCTABlocker     # –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ CTA
```

### –ß–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:

| –ü—Ä–æ–±–ª–µ–º–∞ | –ü—Ä–æ–≤–µ—Ä–∫–∞ | –†–µ—à–µ–Ω–∏–µ |
|----------|----------|---------|
| –ù–µ—Ç –æ—Ç–≤–µ—Ç–∞ –æ—Ç API | –õ–æ–≥–∏ `httpx.TimeoutException` | –£–≤–µ–ª–∏—á–∏—Ç—å timeout –∏–ª–∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–µ—Ç—å |
| –ù–µ–≤–µ—Ä–Ω–∞—è –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è | `DEBUG Router result` | –ü—Ä–æ–≤–µ—Ä–∏—Ç—å trigger_words –≤ summaries.json |
| CTA –Ω–µ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è | `SimpleCTABlocker` –≤ –ª–æ–≥–∞—Ö | –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –∏ rate limiting |
| –Æ–º–æ—Ä –Ω–µ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è | `Zhvanetsky validation failed` | –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–ª–∏–Ω—É –æ—Ç–≤–µ—Ç–∞ –∏ —Å–∏–≥–Ω–∞–ª—ã |

### –ú–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏:
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–µ—Ç—Ä–∏–∫
curl http://localhost:8000/metrics

# –û—Ç–≤–µ—Ç:
{
  "uptime_seconds": 3600,
  "total_requests": 150,
  "avg_latency": 2.3,
  "signal_distribution": {
    "exploring_only": 45,
    "price_sensitive": 30,
    "anxiety_about_child": 20,
    "ready_to_buy": 5
  }
}
```

## üìû –ö–æ–Ω—Ç–∞–∫—Ç—ã –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∞

- **GitHub Issues:** https://github.com/anthropics/claude-code/issues
- **–û—Å–Ω–æ–≤–Ω–∞—è –≤–µ—Ç–∫–∞:** main
- **–í–µ—Ç–∫–∞ —Å —é–º–æ—Ä–æ–º:** feature/zhvanetsky-humor

---

**–°—Ç–∞—Ç—É—Å:** Production Ready ‚úÖ –í—Å–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã  
**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 06.01.2025  
**–í–µ—Ä—Å–∏—è:** 0.13.5  
**–Æ–º–æ—Ä –ñ–≤–∞–Ω–µ—Ü–∫–æ–≥–æ:** ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç! –í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å 80% –¥–ª—è offtopic (–Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞ –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–π)

### –û—Å—Ç–∞–≤—à–∏–µ—Å—è —É–ª—É—á—à–µ–Ω–∏—è –¥–ª—è v1.0:
1. **Retry –º–µ—Ö–∞–Ω–∏–∑–º –¥–ª—è LLM** - –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏ –ø—Ä–∏ —Å–±–æ—è—Ö API
2. **–ö–æ–Ω—Ç–µ–∫—Å—Ç –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –¥–µ—Ç–µ–π** - —Å–∏—Å—Ç–µ–º–∞ –Ω–µ –∑–∞–ø–æ–º–∏–Ω–∞–µ—Ç "—É –º–µ–Ω—è –¥–≤–æ–µ: 9 –∏ 12 –ª–µ—Ç"
3. **–ò–Ω–µ—Ä—Ü–∏—è —Å–∏–≥–Ω–∞–ª–æ–≤** - price_sensitive —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è –º–µ–∂–¥—É —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏ (–ø–æ –¥–∏–∑–∞–π–Ω—É)
4. **–ß—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å anxiety —Ç—Ä–∏–≥–≥–µ—Ä–æ–≤** - —Å–ª–∏—à–∫–æ–º –ª–µ–≥–∫–æ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –Ω–∞ "—Ä–µ–±—ë–Ω–æ–∫ –¥–æ–≤–µ–¥—ë—Ç"
5. **–£–ª—É—á—à–µ–Ω–∏–µ SimpleCTABlocker** - –±–æ–ª–µ–µ —Ç–æ—á–Ω–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∑–∞–≤–µ—Ä—à—ë–Ω–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è (2025 roadmap):
1. **Multi-agent —Å–∏—Å—Ç–µ–º–∞** –≤–º–µ—Å—Ç–æ –º–æ–Ω–æ–ª–∏—Ç–Ω–æ–≥–æ Router
2. **Knowledge Graph** –≤–º–µ—Å—Ç–æ –ª–∏–Ω–µ–π–Ω—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤  
3. **Hybrid retrieval** (–≤–µ–∫—Ç–æ—Ä—ã + BM25 + –≥—Ä–∞—Ñ)
4. **Agentic RAG** —Å –ø–∞–º—è—Ç—å—é –∏ –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏–µ–π

