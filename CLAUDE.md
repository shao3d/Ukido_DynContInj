# Ukido AI Assistant v0.12.1 - Production Ready

## ‚ö° –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

```bash
# ‚ö†Ô∏è –í–ê–ñ–ù–û: –°–∏—Å—Ç–µ–º–∞ —é–º–æ—Ä–∞ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –≤–µ—Ç–∫–µ feature/zhvanetsky-humor
git checkout feature/zhvanetsky-humor  # –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å—Å—è –Ω–∞ –≤–µ—Ç–∫—É —Å —é–º–æ—Ä–æ–º
# git checkout main                    # –ò–ª–∏ –Ω–∞ main –±–µ–∑ —é–º–æ—Ä–∞

# 1. –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞
python src/main.py
# –í –≤–µ—Ç–∫–µ —Å —é–º–æ—Ä–æ–º –ø—Ä–æ–≤–µ—Ä—å: "üé≠ –°–∏—Å—Ç–µ–º–∞ —é–º–æ—Ä–∞ –ñ–≤–∞–Ω–µ—Ü–∫–æ–≥–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ (–≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å: 33.0%)"

# 2. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (–≤—ã–±–µ—Ä–∏ –æ–¥–∏–Ω –≤–∞—Ä–∏–∞–Ω—Ç)
python sandbox_v2.py                   # –°—Ç–∞—Ä–∞—è –ø–µ—Å–æ—á–Ω–∏—Ü–∞ (–ë–ï–ó —é–º–æ—Ä–∞ –≤ –æ–±–µ–∏—Ö –≤–µ—Ç–∫–∞—Ö)
python http_sandbox.py                 # üÜï –ù–û–í–ê–Ø –ø–µ—Å–æ—á–Ω–∏—Ü–∞ (–ü–û–õ–ù–´–ô —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª) - —Å–º. HTTP_SANDBOX_PLAN.md
python test_runner_simple.py [1-15]    # –¢–µ—Å—Ç–æ–≤—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏

# 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏—Å—Ç–µ–º—ã —é–º–æ—Ä–∞
curl -X POST http://localhost:8000/chat \
  -H "Content-Type: application/json" \
  -d '{"user_id": "test", "message": "–ß—Ç–æ –¥—É–º–∞–µ—Ç–µ –ø—Ä–æ —Ñ—É—Ç–±–æ–ª?"}'
```

## üéØ –û –ø—Ä–æ–µ–∫—Ç–µ

**Ukido AI Assistant** - —á–∞—Ç–±–æ—Ç –¥–ª—è –¥–µ—Ç—Å–∫–æ–π —à–∫–æ–ª—ã soft skills
- **–ê—É–¥–∏—Ç–æ—Ä–∏—è**: –†–æ–¥–∏—Ç–µ–ª–∏ –¥–µ—Ç–µ–π 7-14 –ª–µ—Ç –∏–∑ –£–∫—Ä–∞–∏–Ω—ã
- **–í–µ—Ä—Å–∏—è**: 0.11.0 (main) / 0.12.1 (feature/zhvanetsky-humor)
- **–°—Ç–∞—Ç—É—Å**: 
  - `main`: ‚úÖ Production Ready –ë–ï–ó —é–º–æ—Ä–∞
  - `feature/zhvanetsky-humor`: ‚úÖ –Æ–º–æ—Ä –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–∞–±–æ—Ç–∞–µ—Ç
- **GitHub**: https://github.com/shao3d/Ukido_DynContInj
- **Branches**: 
  - `main` - —Å—Ç–∞–±–∏–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è –±–µ–∑ —é–º–æ—Ä–∞
  - `feature/zhvanetsky-humor` - —Å —Å–∏—Å—Ç–µ–º–æ–π —é–º–æ—Ä–∞ –ñ–≤–∞–Ω–µ—Ü–∫–æ–≥–æ

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞: –ò–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω—ã–π Router + –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π Generator

```mermaid
graph LR
    A[User Message] --> B[Gemini Router]
    B -->|offtopic 33%| C[üé≠ –Æ–º–æ—Ä –ñ–≤–∞–Ω–µ—Ü–∫–æ–≥–æ]
    B -->|offtopic 67%| D[–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ —Ñ—Ä–∞–∑—ã]
    B -->|success| E[Claude Generator]
    
    B -.->|–û–ø—Ä–µ–¥–µ–ª—è–µ—Ç| F[user_signal]
    B -.->|–û–ø—Ä–µ–¥–µ–ª—è–µ—Ç| G[social_context]
    B -.->|–ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç| H[implicit questions]
    
    E --> I[–ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –æ—Ç–≤–µ—Ç]
```

### üß† Gemini Router (router.py)
**–ó–∞–¥–∞—á–∏:**
1. **–î–µ–∫–æ–º–ø–æ–∑–∏—Ü–∏—è –≤–æ–ø—Ä–æ—Å–æ–≤** - —Ä–∞–∑–±–∏–≤–∞–µ—Ç —Å–ª–æ–∂–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –Ω–∞ –∞—Ç–æ–º–∞—Ä–Ω—ã–µ
2. **–ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –∏–Ω—Ç–µ–Ω—Ç–∞** - success/offtopic/need_simplification
3. **–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ user_signal** - price_sensitive/anxiety/ready_to_buy/exploring
4. **–í—ã–±–æ—Ä –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤** - –ø–æ–¥–±–∏—Ä–∞–µ—Ç –¥–æ 4 —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
5. **–û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ—Ü–∏–∞–ª—å–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞** - greeting/thanks/farewell/apology
6. **–ì–µ–Ω–µ—Ä–∞—Ü–∏—è implicit questions** - –¥–ª—è ready_to_buy –±–µ–∑ —è–≤–Ω—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤

### üí¨ Claude Generator (response_generator.py)
**–ó–∞–¥–∞—á–∏:**
1. **–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç–≤–µ—Ç–∞** –Ω–∞ –æ—Å–Ω–æ–≤–µ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –∏ –≤–æ–ø—Ä–æ—Å–æ–≤
2. **Tone adaptation** - –∞–¥–∞–ø—Ç–∞—Ü–∏—è —Å—Ç–∏–ª—è –ø–æ–¥ user_signal
3. **Dynamic few-shot** - –ø—Ä–∏–º–µ—Ä—ã –ø–æ–¥ —Ç–∏–ø –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
4. **Offers injection** - –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ CTA –≤ –∫–æ–Ω—Ü–µ
5. **Fallback –¥–ª—è –ø—É—Å—Ç—ã—Ö questions** - —É—Ç–æ—á–Ω—è—é—â–∏–µ –≤–æ–ø—Ä–æ—Å—ã –≤–º–µ—Å—Ç–æ "–ù–µ –ø–æ–Ω—è–ª"

### –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –§–∞–π–ª | –§—É–Ω–∫—Ü–∏—è |
|-----------|------|---------|
| **Main** | `src/main.py` | FastAPI —Å–µ—Ä–≤–µ—Ä, –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä, –º–µ—Ç—Ä–∏–∫–∏ |
| **Router** | `src/router.py` | –ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –∏–Ω—Ç–µ–Ω—Ç–æ–≤ —á–µ—Ä–µ–∑ Gemini |
| **Generator** | `src/response_generator.py` | –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç–≤–µ—Ç–æ–≤ —á–µ—Ä–µ–∑ Claude |
| **–Æ–º–æ—Ä** | `src/zhvanetsky_humor.py` | –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —é–º–æ—Ä–∞ —á–µ—Ä–µ–∑ Claude Haiku |
| **–ò—Å—Ç–æ—Ä–∏—è** | `src/history_manager.py` | LRU Cache –Ω–∞ 1000 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π |
| **Offers** | `src/offers_catalog.py` | –ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è |
| **Social** | `src/social_state.py` | –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Å–æ—Ü–∏–∞–ª—å–Ω—ã—Ö –∏–Ω—Ç–µ–Ω—Ç–æ–≤ |
| **Config** | `src/config.py` | –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∏—Å—Ç–µ–º—ã |
| **Standards** | `src/standard_responses.py` | –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ offtopic –æ—Ç–≤–µ—Ç—ã |

## üéØ State Machine - 4 —Å–∏–≥–Ω–∞–ª–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

### –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å–∏–≥–Ω–∞–ª–æ–≤:
```python
price_sensitive:     # –°–∫–µ–ø—Ç–∏–∫–∏ –∏ —Ç–æ—Ä–≥–æ–≤—Ü—ã
  - "30 —Ç—ã—Å—è—á?!", "–¥–æ—Ä–æ–≥–æ", "—Ä–∞–∑–≤–æ–¥?"
  - –ò–Ω–µ—Ä—Ü–∏—è 85% - —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤–µ—Å—å –¥–∏–∞–ª–æ–≥
  
anxiety_about_child: # –¢—Ä–µ–≤–æ–∂–Ω—ã–µ —Ä–æ–¥–∏—Ç–µ–ª–∏  
  - "—Å—Ç–µ—Å–Ω–∏—Ç–µ–ª—å–Ω—ã–π", "–±–æ–∏—Ç—Å—è", "–∑–∞–º–∫–Ω—É—Ç—ã–π"
  - –¢—Ä–µ–±—É–µ—Ç —ç–º–ø–∞—Ç–∏–∏ –≤ –ø–µ—Ä–≤–æ–º –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–∏
  
ready_to_buy:        # –ì–æ—Ç–æ–≤—ã–µ –∫ –¥–µ–π—Å—Ç–≤–∏—é
  - "–∑–∞–ø–∏—à–∏—Ç–µ", "—Å–æ–≥–ª–∞—Å–Ω—ã", "–¥–µ–π—Å—Ç–≤—É–µ–º"
  - –í–°–ï–ì–î–ê –ø–æ–ª—É—á–∞–µ—Ç implicit question –µ—Å–ª–∏ –Ω–µ—Ç —è–≤–Ω–æ–≥–æ
  
exploring_only:      # –ü–∞—Å—Å–∏–≤–Ω—ã–µ –∏—Å—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª–∏
  - "—Ä–∞—Å—Å–∫–∞–∂–∏—Ç–µ –æ —à–∫–æ–ª–µ", "–∫–∞–∫–∏–µ –Ω–∞–≤—ã–∫–∏"
  - –ù–ï –ø–æ–ª—É—á–∞–µ—Ç –∞–≥—Ä–µ—Å—Å–∏–≤–Ω—ã—Ö offers
```

### –ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è –æ—Ç–≤–µ—Ç–æ–≤:
- **Dynamic few-shot** - —Ä–∞–∑–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ signal
- **Tone adaptation** - —Å—Ç–∏–ª—å –º–µ–Ω—è–µ—Ç—Å—è –ø–æ–¥ —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
- **Offers catalog** - –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –≤ –∫–æ–Ω—Ü–µ

## üìä –¢–µ–∫—É—â–∏–µ –º–µ—Ç—Ä–∏–∫–∏

- **State Machine**: 98% —Ç–æ—á–Ω–æ—Å—Ç—å (10/10 —Ç–µ—Å—Ç–æ–≤ –ø—Ä–æ–π–¥–µ–Ω–æ)
- **–ü–∞–º—è—Ç—å**: <5MB –¥–ª—è 1000 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (LRU Cache)
- **–î–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ—Å—Ç—å**: 100% (seed=42)
- **–í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞**: 7-9 —Å–µ–∫ (—Å—Ç–∞–Ω–¥–∞—Ä—Ç), ~2 —Å–µ–∫ (—é–º–æ—Ä)
- **–°—Ç–æ–∏–º–æ—Å—Ç—å**: ~$0.0016 (—Å—Ç–∞–Ω–¥–∞—Ä—Ç), ~$0.0003 (—é–º–æ—Ä)
- **–Æ–º–æ—Ä**: 33% –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å, 3 —à—É—Ç–∫–∏/—á–∞—Å –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

## üé≠ –°–∏—Å—Ç–µ–º–∞ —é–º–æ—Ä–∞ –ñ–≤–∞–Ω–µ—Ü–∫–æ–≥–æ (–≤–µ—Ç–∫–∞ feature/zhvanetsky-humor)

### –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:
1. **–¢–æ–ª—å–∫–æ –¥–ª—è offtopic** —Å–æ–æ–±—â–µ–Ω–∏–π
2. **33% –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å** —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏—è
3. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**: –±–ª–µ–∫–ª–∏—Å—Ç –æ–ø–∞—Å–Ω—ã—Ö —Ç–µ–º
4. **Rate limiting**: –º–∞–∫—Å 3 —à—É—Ç–∫–∏/—á–∞—Å
5. **–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è**: –ù–ï —à—É—Ç–∏—Ç –ø—Ä–∏ anxiety/price_sensitive

### –ì–ª–æ–±–∞–ª—å–Ω—ã–µ —Å–∏–Ω–≥–ª—Ç–æ–Ω—ã (–≤–∞–∂–Ω–æ!):
- `zhvanetsky_generator` - —Å–æ–∑–¥–∞—ë—Ç—Å—è –≤ main.py –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ
- `zhvanetsky_safety_checker` - —Å–æ–∑–¥–∞—ë—Ç—Å—è –≤ main.py –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ
- –ú–µ—Ç—Ä–∏–∫–∏ —Å–æ–±–∏—Ä–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ —ç—Ç–∏ —ç–∫–∑–µ–º–ø–ª—è—Ä—ã

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —é–º–æ—Ä–∞:
```bash
# –ß–µ—Ä–µ–∑ HTTP API (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
curl -X POST http://localhost:8000/chat \
  -H "Content-Type: application/json" \
  -d '{"user_id": "humor_test", "message": "–ß—Ç–æ –¥—É–º–∞–µ—Ç–µ –ø—Ä–æ —Ñ—É—Ç–±–æ–ª?"}'

# –ß–µ—Ä–µ–∑ —Ç–µ—Å—Ç—ã
python test_humor_basic.py      # Mock —Ç–µ—Å—Ç—ã
python HUMOR_TEST_REPORT.md     # –û—Ç—á—ë—Ç –æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏
```

## üÜï HTTP API –ü–µ—Å–æ—á–Ω–∏—Ü–∞ (TODO - —Å–ª–µ–¥—É—é—â–∞—è —Å–µ—Å—Å–∏—è)

**–ü–æ–ª–Ω—ã–π –ø–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏**: —Å–º. `HTTP_SANDBOX_PLAN.md`

### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –Ω–æ–≤–æ–π –ø–µ—Å–æ—á–Ω–∏—Ü—ã:
- ‚úÖ –ü–æ–ª–Ω—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –≤–∫–ª—é—á–∞—è —é–º–æ—Ä
- ‚úÖ –†–∞–±–æ—Ç–∞ —á–µ—Ä–µ–∑ HTTP API
- ‚úÖ –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å–æ —Å—Ç–∞—Ä—ã–º–∏ –∫–æ–º–∞–Ω–¥–∞–º–∏
- ‚úÖ –ê–≤—Ç–æ–¥–µ—Ç–µ–∫—Ü–∏—è —Å–µ—Ä–≤–µ—Ä–∞
- ‚úÖ –í–∏–∑—É–∞–ª—å–Ω—ã–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã —é–º–æ—Ä–∞ üé≠
- ‚úÖ –ü—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä –¥–ª—è batch —Ç–µ—Å—Ç–æ–≤
- ‚úÖ –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ failed –∫–µ–π—Å–æ–≤

### –û—Å–Ω–æ–≤–∞ –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:
- –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –∏–∑ `sandbox_v2.py`
- –î–æ–±–∞–≤–∏—Ç—å HTTP –∫–ª–∏–µ–Ω—Ç —á–µ—Ä–µ–∑ httpx
- –ù–ï —Å–æ–∑–¥–∞–≤–∞—Ç—å Router/ResponseGenerator - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å API

### –í—Ä–µ–º—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏: ~4.5 —á–∞—Å–∞

## üß† –ú–µ—Ç–∫–∏ —É—Ä–æ–≤–Ω–µ–π –¥—É–º–∞–Ω–∏—è (Thinking Levels)

### –ò—Å–ø–æ–ª—å–∑—É–π —ç—Ç–∏ –º–µ—Ç–∫–∏ –¥–ª—è –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ —Ä–∞–∑–Ω—ã—Ö —É—Ä–æ–≤–Ω–µ–π –∞–Ω–∞–ª–∏–∑–∞:

**–†—É—Å—Å–∫–∏–µ –º–µ—Ç–∫–∏ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ):**
- **`@–≥–ª—è–Ω—É`** - –ë—ã—Å—Ç—Ä—ã–π –≤–∑–≥–ª—è–¥, –±–∞–∑–æ–≤—ã–π –∞–Ω–∞–ª–∏–∑
- **`@–≤–Ω–∏–∫–Ω—É`** - –í–Ω–∏–º–∞—Ç–µ–ª—å–Ω—ã–π —Ä–∞–∑–±–æ—Ä (–¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ –±–∞–≥–æ–≤)
- **`@–∫–æ–ø–Ω—É`** - –ì–ª—É–±–æ–∫–æ–µ –ø–æ–≥—Ä—É–∂–µ–Ω–∏–µ (–¥–ª—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã—Ö —Ä–µ—à–µ–Ω–∏–π)
- **`@—Ä–∞–∑–±–µ—Ä–∏—Å—å`** - –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –¥–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –∑–∞–¥–∞—á

**–ê–Ω–≥–ª–∏–π—Å–∫–∏–µ –º–µ—Ç–∫–∏ (–∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞):**
- `@think` - –±–∞–∑–æ–≤–æ–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–µ –º—ã—à–ª–µ–Ω–∏–µ
- `@think-hard` - —É—Å–∏–ª–µ–Ω–Ω—ã–π –∞–Ω–∞–ª–∏–∑  
- `@think-deeper` - –≥–ª—É–±–æ–∫–∏–π –º–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤—ã–π –∞–Ω–∞–ª–∏–∑
- `@ultrathink` - –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –≥–ª—É–±–∏–Ω–∞ —Ä–∞—Å—Å—É–∂–¥–µ–Ω–∏–π

### –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:
```bash
# –ë—ã—Å—Ç—Ä—ã–π –∞–Ω–∞–ª–∏–∑
"@–≥–ª—è–Ω—É –ø–æ—á–µ–º—É —Ç–µ—Å—Ç –ø–∞–¥–∞–µ—Ç"

# –í–Ω–∏–º–∞—Ç–µ–ª—å–Ω—ã–π —Ä–∞–∑–±–æ—Ä –±–∞–≥–æ–≤
"@–≤–Ω–∏–∫–Ω—É –ø–æ—á–µ–º—É anxiety_about_child –∏–º–µ–µ—Ç 60% —Ç–æ—á–Ω–æ—Å—Ç—å"

# –ì–ª—É–±–æ–∫–æ–µ –ø–æ–≥—Ä—É–∂–µ–Ω–∏–µ –≤ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É
"@–∫–æ–ø–Ω—É –∫–∞–∫ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å Router —Å 44K —Ç–æ–∫–µ–Ω–æ–≤"

# –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –¥–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –∑–∞–¥–∞—á
"@—Ä–∞–∑–±–µ—Ä–∏—Å—å –∫–∞–∫ –ø–µ—Ä–µ–ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å State Machine –¥–ª—è –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è"
```

## üìã –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
src/
‚îú‚îÄ‚îÄ main.py                # FastAPI —Å–µ—Ä–≤–µ—Ä, –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä
‚îú‚îÄ‚îÄ router.py              # Gemini —Ä–æ—É—Ç–µ—Ä
‚îú‚îÄ‚îÄ response_generator.py  # Claude –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä
‚îú‚îÄ‚îÄ zhvanetsky_humor.py    # –Æ–º–æ—Ä –ñ–≤–∞–Ω–µ—Ü–∫–æ–≥–æ
‚îú‚îÄ‚îÄ zhvanetsky_safety.py   # –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å —é–º–æ—Ä–∞
‚îú‚îÄ‚îÄ zhvanetsky_golden.py   # 48 –ø—Ä–∏–º–µ—Ä–æ–≤ —é–º–æ—Ä–∞
‚îú‚îÄ‚îÄ history_manager.py     # LRU Cache –∏—Å—Ç–æ—Ä–∏–∏
‚îú‚îÄ‚îÄ offers_catalog.py      # –ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ CTA
‚îú‚îÄ‚îÄ social_state.py        # –°–æ—Ü–∏–∞–ª—å–Ω—ã–µ –∏–Ω—Ç–µ–Ω—Ç—ã
‚îú‚îÄ‚îÄ standard_responses.py  # Offtopic —Ñ—Ä–∞–∑—ã
‚îú‚îÄ‚îÄ config.py              # –ù–∞—Å—Ç—Ä–æ–π–∫–∏
‚îî‚îÄ‚îÄ knowledge_base/        # –ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π (16 –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤)

tests/
‚îú‚îÄ‚îÄ test_comprehensive_dialogues.json  # 15 —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∏–∞–ª–æ–≥–æ–≤
‚îú‚îÄ‚îÄ test_runner_simple.py             # –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤
‚îú‚îÄ‚îÄ test_dialogue_viewer.py           # –ü—Ä–æ—Å–º–æ—Ç—Ä –¥–∏–∞–ª–æ–≥–æ–≤
‚îî‚îÄ‚îÄ test_humor_basic.py                # –¢–µ—Å—Ç—ã —é–º–æ—Ä–∞

# –ü–µ—Å–æ—á–Ω–∏—Ü—ã
sandbox_v2.py              # –°—Ç–∞—Ä–∞—è –ø–µ—Å–æ—á–Ω–∏—Ü–∞ (–ë–ï–ó —é–º–æ—Ä–∞)
http_sandbox.py            # –ù–æ–≤–∞—è –ø–µ—Å–æ—á–Ω–∏—Ü–∞ (TODO)
```

## üí° –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
```bash
python test_state_machine_fixes.py     # State Machine —Ç–µ—Å—Ç—ã
python test_dialogue_viewer.py [1-15]  # –ü—Ä–æ—Å–º–æ—Ç—Ä –¥–∏–∞–ª–æ–≥–æ–≤
python show_responses.py               # –ü–æ—Å–ª–µ–¥–Ω–∏–µ –æ—Ç–≤–µ—Ç—ã
```

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
```bash
curl http://localhost:8000/metrics     # –ú–µ—Ç—Ä–∏–∫–∏ —Å–∏—Å—Ç–µ–º—ã
curl http://localhost:8000/health      # –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è
tail -f server.log                     # –õ–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞
```

## ‚ö†Ô∏è –ß—Ç–æ –º–æ–∂–Ω–æ —É–ª—É—á—à–∏—Ç—å (–Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ)

### üü° –í—ã—è–≤–ª–µ–Ω–Ω—ã–µ –Ω–µ–∫—Ä–∏—Ç–∏—á–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:
1. **–¢–µ–ª–µ–≥—Ä–∞—Ñ–Ω—ã–π —Å—Ç–∏–ª—å –Ω–µ –≤—Å–µ–≥–¥–∞ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –∫–∞–∫ ready_to_buy**
   - –ü—Ä–∏–º–µ—Ä: "–ö—É—Ä—Å –ª–∏–¥–µ—Ä—Å—Ç–≤–æ. –¶–µ–Ω–∞? –°—Ç–∞—Ä—Ç?" ‚Üí exploring_only –≤–º–µ—Å—Ç–æ ready_to_buy
   - –í–ª–∏—è–Ω–∏–µ: –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ, –∫–æ–Ω–≤–µ—Ä—Å–∏—è –≤—Å–µ —Ä–∞–≤–Ω–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç
   
2. **"–¶–µ–Ω–∞ –Ω–µ –≤–∞–∂–Ω–∞" –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –∫–∞–∫ price_sensitive**
   - –õ–æ–≥–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞: —Ñ—Ä–∞–∑–∞ –æ–∑–Ω–∞—á–∞–µ—Ç –ù–ï—á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∫ —Ü–µ–Ω–µ
   - –í–ª–∏—è–Ω–∏–µ: –û—Ç–≤–µ—Ç –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å–æ —Å–∫–∏–¥–æ–∫, —Ö–æ—Ç—è –æ–Ω–∏ –Ω–µ –Ω—É–∂–Ω—ã
   
3. **–ö–æ—Ä–æ—Ç–∫–∏–µ –≤–æ–ø—Ä–æ—Å—ã –æ —Ü–µ–Ω–µ –ø–æ—Å–ª–µ anxiety –º–æ–≥—É—Ç —Å–±—Ä–æ—Å–∏—Ç—å —Å–∏–≥–Ω–∞–ª**
   - –ü–æ—Å–ª–µ 4+ —Å–æ–æ–±—â–µ–Ω–∏–π anxiety, "–°–∫–æ–ª—å–∫–æ?" –º–æ–∂–µ—Ç –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—å –Ω–∞ price_sensitive
   - –í–ª–∏—è–Ω–∏–µ: –°—Ä–µ–¥–Ω–µ–µ, –Ω–æ —Ä–æ–¥–∏—Ç–µ–ª—å —É–∂–µ –ø–æ–ª—É—á–∏–ª —ç–º–ø–∞—Ç–∏—á–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã

## üìù –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### –ù–µ–∫—Ä–∏—Ç–∏—á–Ω—ã–µ:
1. **–í–∞–ª–∏–¥–∞—Ü–∏—è —é–º–æ—Ä–∞**: `no_school_reference` - –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ —à—É—Ç–∫–∏ –æ—Ç–∫–ª–æ–Ω—è—é—Ç—Å—è
2. **Timeout 3 —Å–µ–∫**: –∏–Ω–æ–≥–¥–∞ –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —é–º–æ—Ä–∞
3. **sandbox_v2.py**: –ù–ï –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Å–∏—Å—Ç–µ–º—É —é–º–æ—Ä–∞

### –†–µ—à–µ–Ω–∏—è:
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `http_sandbox.py` (–∫–æ–≥–¥–∞ –±—É–¥–µ—Ç —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω)
- –£–≤–µ–ª–∏—á–∏—Ç—å timeout –¥–æ 5 —Å–µ–∫ –≤ `config.py`
- –û—Å–ª–∞–±–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é –≤ `zhvanetsky_humor.py`

## üöÄ Production Checklist

```python
PRODUCTION_CONFIG = {
    "MAX_USERS": 1000,              # LRU Cache
    "RANDOM_SEED": 42,              # –î–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ—Å—Ç—å
    "HISTORY_LIMIT": 10,            # –°–æ–æ–±—â–µ–Ω–∏–π –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    "ROUTER_MODEL": "gemini-2.5-flash",
    "GENERATOR_MODEL": "claude-3.5-haiku",
    "HUMOR_MODEL": "claude-3.5-haiku",
    "HUMOR_PROBABILITY": 0.33,
    "HUMOR_MAX_PER_HOUR": 3
}
```

## üîë API –∫–ª—é—á–∏ –∏ —Å–µ—Ä–≤–∏—Å—ã

- **OpenRouter API**: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –≤—Å–µ—Ö LLM –º–æ–¥–µ–ª–µ–π
- **–ö–ª—é—á –≤ `.env`**: `OPENROUTER_API_KEY`
- **–ú–æ–¥–µ–ª–∏**:
  - Router: `google/gemini-2.5-flash`
  - Generator: `openai/gpt-4o-mini` (—á–µ—Ä–µ–∑ MODEL_ANSWER)
  - Humor: `anthropic/claude-3.5-haiku`

## üìà –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π

### v0.12.1 (23.08.2025) - –°–∏—Å—Ç–µ–º–∞ —é–º–æ—Ä–∞ –ü–û–õ–ù–û–°–¢–¨–Æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ üé≠
#### –ß—Ç–æ –±—ã–ª–æ —Å–ª–æ–º–∞–Ω–æ:
- ‚ùå –Æ–º–æ—Ä –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–ª—Å—è –≤ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö —ç–∫–∑–µ–º–ø–ª—è—Ä–∞—Ö (–º–µ—Ç—Ä–∏–∫–∏ —Ç–µ—Ä—è–ª–∏—Å—å)
- ‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –ø–µ—Ä–µ–¥–∞—á–∞ OpenRouter client
- ‚ùå –°–ª–æ–º–∞–Ω–Ω—ã–π async/await –¥–ª—è Claude Haiku
- ‚ùå –ü–∞—Ä—Å–∏–Ω–≥ –æ—Ç–≤–µ—Ç–∞ –æ–∂–∏–¥–∞–ª —Å–ª–æ–≤–∞—Ä—å –≤–º–µ—Å—Ç–æ —Å—Ç—Ä–æ–∫–∏
- ‚ùå –ò–º–ø–æ—Ä—Ç—ã —Å –ø—Ä–µ—Ñ–∏–∫—Å–æ–º `src.` –Ω–µ —Ä–∞–±–æ—Ç–∞–ª–∏

#### –ß—Ç–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:
- ‚úÖ –°–æ–∑–¥–∞–Ω –≥–ª–æ–±–∞–ª—å–Ω—ã–π —Å–∏–Ω–≥–ª—Ç–æ–Ω –¥–ª—è ZhvanetskyGenerator –∏ SafetyChecker
- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –ø–µ—Ä–µ–¥–∞—á–∞ client —Å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –º–æ–¥–µ–ª—å—é `anthropic/claude-3.5-haiku`
- ‚úÖ –ü–æ—á–∏–Ω–µ–Ω async/await –≤ –º–µ—Ç–æ–¥–µ `_call_claude_haiku`
- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω –ø–∞—Ä—Å–∏–Ω–≥ –æ—Ç–≤–µ—Ç–∞ –æ—Ç OpenRouterClient
- ‚úÖ –£–±—Ä–∞–Ω—ã –ø—Ä–µ—Ñ–∏–∫—Å—ã `src.` –∏–∑ –∏–º–ø–æ—Ä—Ç–æ–≤
- ‚úÖ –ú–µ—Ç—Ä–∏–∫–∏ —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É—é—Ç –≥–ª–æ–±–∞–ª—å–Ω—ã–π —ç–∫–∑–µ–º–ø–ª—è—Ä
- ‚úÖ Rate limiting —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

### v0.11.0 (21.08.2025) - Production Ready MVP üöÄ
#### –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
- ‚úÖ **Memory Leak —É—Å—Ç—Ä–∞–Ω—ë–Ω** - LRU Cache —Å –ª–∏–º–∏—Ç–æ–º 1000 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- ‚úÖ **–î–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ—Å—Ç—å –¥–æ–±–∞–≤–ª–µ–Ω–∞** - random.seed(42) –≤–æ –≤—Å–µ—Ö –º–æ–¥—É–ª—è—Ö
- ‚úÖ **State Machine —Ñ–∏–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω** - 98% —Ç–æ—á–Ω–æ—Å—Ç—å –Ω–∞ —Ç–µ—Å—Ç–∞—Ö

### v0.10.0 (20.08.2025) - –í–∞—Ä–∏–∞–Ω—Ç 4: –£–º–Ω—ã–π –∞–Ω–∞–ª–∏–∑
- ‚úÖ Router –ø–µ—Ä–µ–¥–∞—ë—Ç original_message
- ‚úÖ Generator –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –¥–ª–∏–Ω—É –∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç
- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω price_sensitive –¥–ª—è –∫–æ—Ä–æ—Ç–∫–∏—Ö —Ä–µ–ø–ª–∏–∫

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- `README.md` - –æ–±—â–µ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞
- `HTTP_SANDBOX_PLAN.md` - –ø–ª–∞–Ω –Ω–æ–≤–æ–π –ø–µ—Å–æ—á–Ω–∏—Ü—ã (–¥–µ—Ç–∞–ª—å–Ω—ã–π –ø–ª–∞–Ω —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏ –∫–æ–¥–∞)
- `HUMOR_TEST_REPORT.md` - –æ—Ç—á—ë—Ç –æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ —é–º–æ—Ä–∞ (23.08.2025)
- `ZHVANETSKY_SPEC.md` - —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã —é–º–æ—Ä–∞

## üì¶ –û—Å–Ω–æ–≤–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

```txt
requirements.txt:
- fastapi
- uvicorn
- httpx          # –î–ª—è HTTP –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ LLM
- python-dotenv  # –î–ª—è .env —Ñ–∞–π–ª–∞
```

---

**–°—Ç–∞—Ç—É—Å**: 
- `main`: Production Ready ‚úÖ (–±–µ–∑ —é–º–æ—Ä–∞)
- `feature/zhvanetsky-humor`: Production Ready ‚úÖ (—Å —é–º–æ—Ä–æ–º)

**–ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å**: 100%
**–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –±–∞–≥–∏**: 0
**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ**: 23.08.2025 (–≤—Ç–æ—Ä–∞—è —Å–µ—Å—Å–∏—è)

**‚ö†Ô∏è –î–ª—è —Ä–∞–±–æ—Ç—ã —Å —é–º–æ—Ä–æ–º**: `git checkout feature/zhvanetsky-humor`