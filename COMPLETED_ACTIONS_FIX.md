# –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è –∑–∞–≤–µ—Ä—à—ë–Ω–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π

## üìå –ü—Ä–æ–±–ª–µ–º–∞

–ö–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–æ–±—â–∞–µ—Ç –æ –∑–∞–≤–µ—Ä—à—ë–Ω–Ω–æ–º –¥–µ–π—Å—Ç–≤–∏–∏ –±–µ–∑ —è–≤–Ω–æ–≥–æ –≤–æ–ø—Ä–æ—Å–∞, Router –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç —ç—Ç–æ –∫–∞–∫ offtopic:
- "–û–ø–ª–∞—Ç–∏–ª–∞ –ø–µ—Ä–µ–≤–æ–¥. –ñ–¥—É –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è" ‚Üí offtopic ‚ùå
- "–ó–∞–ø–æ–ª–Ω–∏–ª —Ñ–æ—Ä–º—É –Ω–∞ —Å–∞–π—Ç–µ" ‚Üí offtopic ‚ùå  
- "–ó–∞–ø–∏—Å–∞–ª–∏—Å—å –Ω–∞ –ø—Ä–æ–±–Ω–æ–µ" ‚Üí offtopic ‚ùå

**–û–∂–∏–¥–∞–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ:** —Å–∏—Å—Ç–µ–º–∞ –¥–æ–ª–∂–Ω–∞ —Ä–∞—Å–ø–æ–∑–Ω–∞—Ç—å –∑–∞–≤–µ—Ä—à—ë–Ω–Ω–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ –∏ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —É—Ç–æ—á–Ω—è—é—â–∏–π –≤–æ–ø—Ä–æ—Å –æ —Å–ª–µ–¥—É—é—â–∏—Ö —à–∞–≥–∞—Ö.

## üéØ MVP –†–µ—à–µ–Ω–∏–µ: –ü–æ—Å—Ç–æ–±—Ä–∞–±–æ—Ç–∫–∞ –≤ main.py

### –ü–æ—á–µ–º—É –Ω–µ –≤ Router:
1. Router —É–∂–µ –ø–µ—Ä–µ–≥—Ä—É–∂–µ–Ω (600+ —Å—Ç—Ä–æ–∫ –ø—Ä–æ–º–ø—Ç–∞)
2. –ú–Ω–æ–∂–µ—Å—Ç–≤–æ –≤–∞—Ä–∏–∞—Ü–∏–π –∑–∞–≤–µ—Ä—à—ë–Ω–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π —Å–ª–æ–∂–Ω–æ –æ–ø–∏—Å–∞—Ç—å –≤ –ø—Ä–æ–º–ø—Ç–µ
3. –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ Router —Ç—Ä–µ–±—É—é—Ç —Å–±—Ä–æ—Å–∞ –∫–µ—à–∞ Gemini

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ä–µ—à–µ–Ω–∏—è:

```python
# –í main.py, –ø–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è –æ—Ç–≤–µ—Ç–∞ –æ—Ç Router (—Å—Ç—Ä–æ–∫–∞ ~152)

def detect_completed_action(message: str, router_result: dict) -> dict:
    """
    –î–µ—Ç–µ–∫—Ç–∏—Ä—É–µ—Ç –∑–∞–≤–µ—Ä—à—ë–Ω–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è –∏ –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç Router'–∞
    """
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ Router –≤–µ—Ä–Ω—É–ª offtopic
    if router_result.get("status") != "offtopic":
        return router_result
    
    # –ü–∞—Ç—Ç–µ—Ä–Ω—ã –∑–∞–≤–µ—Ä—à—ë–Ω–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π
    COMPLETED_PATTERNS = {
        "payment": ["–æ–ø–ª–∞—Ç–∏–ª", "–æ–ø–ª–∞—Ç–∏–ª–∞", "–ø–µ—Ä–µ–≤—ë–ª", "–ø–µ—Ä–µ–≤–µ–ª–∞", "–æ—Ç–ø—Ä–∞–≤–∏–ª –¥–µ–Ω—å–≥–∏", "–∑–∞–ø–ª–∞—Ç–∏–ª"],
        "registration": ["–∑–∞–ø–∏—Å–∞–ª—Å—è", "–∑–∞–ø–∏—Å–∞–ª–∏—Å—å", "–∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–ª", "–ø–æ–¥–∞–ª –∑–∞—è–≤–∫—É"],
        "form": ["–∑–∞–ø–æ–ª–Ω–∏–ª —Ñ–æ—Ä–º—É", "–æ—Ç–ø—Ä–∞–≤–∏–ª –∞–Ω–∫–µ—Ç—É", "–∑–∞–ø–æ–ª–Ω–∏–ª–∞ —Ñ–æ—Ä–º—É"],
        "documents": ["–æ—Ç–ø—Ä–∞–≤–∏–ª –¥–æ–∫—É–º–µ–Ω—Ç—ã", "–ø—Ä–∏—Å–ª–∞–ª –¥–æ–∫—É–º–µ–Ω—Ç—ã", "–∑–∞–≥—Ä—É–∑–∏–ª –¥–æ–∫—É–º–µ–Ω—Ç—ã"],
        "trial": ["–∑–∞–ø–∏—Å–∞–ª–∏—Å—å –Ω–∞ –ø—Ä–æ–±–Ω–æ–µ", "–∑–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞–ª –ø—Ä–æ–±–Ω–æ–µ"],
    }
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –≤–æ–ø—Ä–æ—Å–∏—Ç–µ–ª—å–Ω—ã–µ —Å–ª–æ–≤–∞ (–µ—Å–ª–∏ –µ—Å—Ç—å - —ç—Ç–æ –Ω–µ statement)
    question_words = ["–∫–∞–∫", "—á—Ç–æ", "–∫–æ–≥–¥–∞", "–≥–¥–µ", "–ø–æ—á–µ–º—É", "–∑–∞—á–µ–º", "—Å–∫–æ–ª—å–∫–æ", "?"]
    if any(word in message.lower() for word in question_words):
        return router_result
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–ª–∏–Ω—ã (–∑–∞–≤–µ—Ä—à—ë–Ω–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è –æ–±—ã—á–Ω–æ –∫–æ—Ä–æ—Ç–∫–∏–µ)
    if len(message.split()) > 10:
        return router_result
    
    # –ò—â–µ–º –ø–∞—Ç—Ç–µ—Ä–Ω—ã
    message_lower = message.lower()
    action_type = None
    
    for action, patterns in COMPLETED_PATTERNS.items():
        if any(pattern in message_lower for pattern in patterns):
            action_type = action
            break
    
    if not action_type:
        return router_result
    
    # –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç Router'–∞
    corrected_result = router_result.copy()
    corrected_result["status"] = "success"
    
    # –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ –≤–æ–ø—Ä–æ—Å—ã
    implicit_questions = {
        "payment": [
            "–ö–æ–≥–¥–∞ –±—É–¥–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –æ–ø–ª–∞—Ç—ã?",
            "–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã?"
        ],
        "registration": [
            "–ö–æ–≥–¥–∞ –Ω–∞—á–∏–Ω–∞—é—Ç—Å—è –∑–∞–Ω—è—Ç–∏—è?",
            "–ß—Ç–æ –Ω—É–∂–Ω–æ –ø–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –∫ –ø–µ—Ä–≤–æ–º—É –∑–∞–Ω—è—Ç–∏—é?"
        ],
        "form": [
            "–ö–æ–≥–¥–∞ —Å –≤–∞–º–∏ —Å–≤—è–∂–µ—Ç—Å—è –º–µ–Ω–µ–¥–∂–µ—Ä?",
            "–ö–∞–∫–∏–µ —Å–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏?"
        ],
        "documents": [
            "–ö–æ–≥–¥–∞ –±—É–¥–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤?",
            "–ù—É–∂–Ω—ã –ª–∏ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã?"
        ],
        "trial": [
            "–ö–∞–∫ –ø–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å—Å—è –∫ –ø—Ä–æ–±–Ω–æ–º—É –∑–∞–Ω—è—Ç–∏—é?",
            "–ß—Ç–æ –≤–∑—è—Ç—å —Å —Å–æ–±–æ–π –Ω–∞ –ø—Ä–æ–±–Ω–æ–µ?"
        ]
    }
    
    corrected_result["decomposed_questions"] = implicit_questions.get(action_type, ["–ö–∞–∫–∏–µ —Å–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏?"])
    corrected_result["documents"] = ["faq.md", "conditions.md"]  # –†–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã
    corrected_result["_correction_applied"] = True  # –î–ª—è –æ—Ç–ª–∞–¥–∫–∏
    
    print(f"üîß –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞: –∑–∞–≤–µ—Ä—à—ë–Ω–Ω–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ '{action_type}' —Ä–∞—Å–ø–æ–∑–Ω–∞–Ω–æ")
    
    return corrected_result

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ (–ø–æ—Å–ª–µ —Å—Ç—Ä–æ–∫–∏ 151 –≤ main.py):
route_result = await router.route(request.message, history_messages, request.user_id)
route_result = detect_completed_action(request.message, route_result)  # –î–æ–±–∞–≤–∏—Ç—å —ç—Ç—É —Å—Ç—Ä–æ–∫—É
```

## üìã –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ —Ä–µ—à–µ–Ω–∏—è

1. **–ù–µ —Ç—Ä–æ–≥–∞–µ–º Router** - –ø—Ä–æ–º–ø—Ç –æ—Å—Ç–∞—ë—Ç—Å—è —Å—Ç–∞–±–∏–ª—å–Ω—ã–º
2. **–ü—Ä–æ—Å—Ç–æ—Ç–∞ –æ—Ç–ª–∞–¥–∫–∏** - –≤—Å—è –ª–æ–≥–∏–∫–∞ –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ
3. **–õ–µ–≥–∫–æ —Ä–∞—Å—à–∏—Ä—è—Ç—å** - –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤ —Ç—Ä–∏–≤–∏–∞–ª—å–Ω–æ
4. **–ü—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å** - –ª–æ–≥–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç –∫–æ–≥–¥–∞ –ø—Ä–∏–º–µ–Ω—è–ª–∞—Å—å –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞
5. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** - —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –¥–ª—è offtopic —Å—Ç–∞—Ç—É—Å–æ–≤

## üß™ –¢–µ—Å—Ç–æ–≤—ã–µ –∫–µ–π—Å—ã

```python
# test_completed_actions.py

test_cases = [
    # –î–æ–ª–∂–Ω—ã —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞—Ç—å—Å—è –∫–∞–∫ –∑–∞–≤–µ—Ä—à—ë–Ω–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è
    ("–û–ø–ª–∞—Ç–∏–ª–∞ –ø–µ—Ä–µ–≤–æ–¥", True),
    ("–ó–∞–ø–æ–ª–Ω–∏–ª —Ñ–æ—Ä–º—É –Ω–∞ —Å–∞–π—Ç–µ", True),
    ("–ó–∞–ø–∏—Å–∞–ª–∏—Å—å –Ω–∞ –ø—Ä–æ–±–Ω–æ–µ", True),
    ("–û—Ç–ø—Ä–∞–≤–∏–ª –¥–æ–∫—É–º–µ–Ω—Ç—ã", True),
    ("–ü–µ—Ä–µ–≤–µ–ª–∞ –¥–µ–Ω—å–≥–∏ –Ω–∞ –∫–∞—Ä—Ç—É", True),
    
    # –ù–ï –¥–æ–ª–∂–Ω—ã —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞—Ç—å—Å—è (–µ—Å—Ç—å –≤–æ–ø—Ä–æ—Å)
    ("–ö–∞–∫ –æ–ø–ª–∞—Ç–∏—Ç—å –ø–µ—Ä–µ–≤–æ–¥?", False),
    ("–ö–æ–≥–¥–∞ –∑–∞–ø–æ–ª–Ω–∏—Ç—å —Ñ–æ—Ä–º—É?", False),
    ("–ì–¥–µ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç—ã?", False),
    
    # –ù–ï –¥–æ–ª–∂–Ω—ã —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞—Ç—å—Å—è (—Å–ª–∏—à–∫–æ–º –¥–ª–∏–Ω–Ω—ã–µ)
    ("–í—á–µ—Ä–∞ —Ö–æ–¥–∏–ª–∏ –≤ –∑–æ–æ–ø–∞—Ä–∫ –∏ —Ç–∞–º –≤–∏–¥–µ–ª–∏ —Å–ª–æ–Ω–∞ –∫–æ—Ç–æ—Ä—ã–π –µ–ª –±–∞–Ω–∞–Ω—ã –∏ –±—ã–ª–æ –æ—á–µ–Ω—å –≤–µ—Å–µ–ª–æ", False),
    
    # –ù–ï –¥–æ–ª–∂–Ω—ã —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞—Ç—å—Å—è (–Ω–µ—Ç –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤)
    ("–•–æ—Ä–æ—à–∞—è –ø–æ–≥–æ–¥–∞ —Å–µ–≥–æ–¥–Ω—è", False),
]
```

## üöÄ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. **–†–µ–∞–ª–∏–∑–∞—Ü–∏—è –±–∞–∑–æ–≤–æ–π –≤–µ—Ä—Å–∏–∏** - –¥–æ–±–∞–≤–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏—é –≤ main.py
2. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** - –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞ –≤—Å–µ—Ö –¥–∏–∞–ª–æ–≥–∞—Ö
3. **–†–∞—Å—à–∏—Ä–µ–Ω–∏–µ –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤** - –¥–æ–±–∞–≤–∏—Ç—å –±–æ–ª—å—à–µ –≤–∞—Ä–∏–∞—Ü–∏–π –ø–æ –º–µ—Ä–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è
4. **–ú–µ—Ç—Ä–∏–∫–∏** - –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å % –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–æ–∫ –¥–ª—è –æ—Ü–µ–Ω–∫–∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏

## ‚ö†Ô∏è –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è MVP

- –†–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –¥–ª—è —Ä—É—Å—Å–∫–æ–≥–æ —è–∑—ã–∫–∞
- –ù–µ —É—á–∏—Ç—ã–≤–∞–µ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç –∏—Å—Ç–æ—Ä–∏–∏ –¥–∏–∞–ª–æ–≥–∞
- –ú–æ–∂–µ—Ç –¥–∞–≤–∞—Ç—å –ª–æ–∂–Ω—ã–µ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏—è –Ω–∞ –ø–æ—Ö–æ–∂–∏–µ —Ñ—Ä–∞–∑—ã
- –¢—Ä–µ–±—É–µ—Ç —Ä—É—á–Ω–æ–≥–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤—ã—Ö –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤

## üîÑ –ë—É–¥—É—â–∏–µ —É–ª—É—á—à–µ–Ω–∏—è

1. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ NLP** - –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –≥–ª–∞–≥–æ–ª–∞ —á–µ—Ä–µ–∑ –º–æ—Ä—Ñ–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑
2. **–ö–æ–Ω—Ç–µ–∫—Å—Ç –∏—Å—Ç–æ—Ä–∏–∏** - —É—á—ë—Ç –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –¥–ª—è —Ç–æ—á–Ω–æ—Å—Ç–∏
3. **ML-–º–æ–¥–µ–ª—å** - –æ–±—É—á–µ–Ω–∏–µ –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ç–æ—Ä–∞ –Ω–∞ —Ä–∞–∑–º–µ—á–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
4. **–ú—É–ª—å—Ç–∏—è–∑—ã—á–Ω–æ—Å—Ç—å** - –ø–æ–¥–¥–µ—Ä–∂–∫–∞ —É–∫—Ä–∞–∏–Ω—Å–∫–æ–≥–æ –∏ –∞–Ω–≥–ª–∏–π—Å–∫–æ–≥–æ

---

**–°—Ç–∞—Ç—É—Å:** –ì–æ—Ç–æ–≤–æ –∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –í—ã—Å–æ–∫–∏–π
**–û—Ü–µ–Ω–∫–∞ –≤—Ä–µ–º–µ–Ω–∏:** 1-2 —á–∞—Å–∞ –Ω–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ