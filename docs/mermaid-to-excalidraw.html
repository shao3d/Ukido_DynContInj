<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ukido - –ö–æ–Ω–≤–µ—Ä—Ç–µ—Ä Mermaid –≤ Excalidraw</title>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1600px;
            margin: 0 auto;
        }
        
        h1 {
            color: white;
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .converter {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .panel {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
        }
        
        .panel h2 {
            margin-bottom: 15px;
            color: #333;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }
        
        textarea {
            width: 100%;
            height: 400px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 10px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            resize: vertical;
        }
        
        .diagram-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        
        .diagram-btn {
            padding: 8px 16px;
            background: #f5f5f5;
            border: 1px solid #ddd;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }
        
        .diagram-btn:hover {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }
        
        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        
        .btn {
            padding: 12px 24px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            transition: all 0.3s;
        }
        
        .btn:hover {
            background: #764ba2;
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(0,0,0,0.2);
        }
        
        .btn.secondary {
            background: #6c757d;
        }
        
        .btn.secondary:hover {
            background: #5a6268;
        }
        
        #excalidraw-output {
            min-height: 400px;
            border: 1px solid #ddd;
            border-radius: 10px;
            padding: 15px;
            background: #f8f9fa;
            overflow: auto;
        }
        
        .info {
            background: white;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            color: #666;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }
        
        .info a {
            color: #667eea;
            text-decoration: none;
            font-weight: bold;
        }
        
        .status {
            margin-top: 10px;
            padding: 10px;
            border-radius: 8px;
            text-align: center;
            display: none;
        }
        
        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
            display: block;
        }
        
        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
            display: block;
        }
        
        .status.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
            display: block;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üé® Mermaid ‚Üí Excalidraw –ö–æ–Ω–≤–µ—Ä—Ç–µ—Ä</h1>
        
        <div class="converter">
            <div class="panel">
                <h2>üìù Mermaid –ö–æ–¥</h2>
                
                <div class="diagram-tabs">
                    <button class="diagram-btn" onclick="loadDiagram('architecture')">üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞</button>
                    <button class="diagram-btn" onclick="loadDiagram('sequence')">üìã –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å</button>
                    <button class="diagram-btn" onclick="loadDiagram('flow')">üîÑ –ü—Ä–æ—Ü–µ—Å—Å</button>
                    <button class="diagram-btn" onclick="loadDiagram('pie')">üìä –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ</button>
                </div>
                
                <textarea id="mermaid-input" placeholder="–í—Å—Ç–∞–≤—å—Ç–µ —Å—é–¥–∞ Mermaid –∫–æ–¥ –∏–ª–∏ –≤—ã–±–µ—Ä–∏—Ç–µ –¥–∏–∞–≥—Ä–∞–º–º—É –≤—ã—à–µ...">graph TB
    U[–†–æ–¥–∏—Ç–µ–ª—å]
    API[FastAPI Server]
    R[Gemini Router]
    G[Claude Generator]
    KB[(–ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π)]
    
    U -->|POST /chat| API
    API --> R
    R --> KB
    R --> G
    G --> API
    API --> U
    
    style U fill:#e1f5fe
    style API fill:#fff3e0
    style R fill:#f3e5f5
    style G fill:#f3e5f5
    style KB fill:#e8f5e9</textarea>
                
                <div class="button-group">
                    <button class="btn" onclick="convertToExcalidraw()">üîÑ –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
                    <button class="btn secondary" onclick="clearInput()">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å</button>
                </div>
                
                <div id="status-message" class="status"></div>
            </div>
            
            <div class="panel">
                <h2>‚ú® Excalidraw JSON</h2>
                <div id="excalidraw-output">
                    <p style="color: #999; text-align: center; margin-top: 150px;">
                        –†–µ–∑—É–ª—å—Ç–∞—Ç –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ –ø–æ—è–≤–∏—Ç—Å—è –∑–¥–µ—Å—å...<br><br>
                        –ü–æ—Å–ª–µ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ –≤—ã —Å–º–æ–∂–µ—Ç–µ:<br>
                        1. –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å JSON<br>
                        2. –û—Ç–∫—Ä—ã—Ç—å –≤ Excalidraw<br>
                        3. –°–∫–∞—á–∞—Ç—å –∫–∞–∫ —Ñ–∞–π–ª
                    </p>
                </div>
                
                <div class="button-group">
                    <button class="btn" onclick="copyToClipboard()" id="copy-btn" disabled>üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å JSON</button>
                    <button class="btn" onclick="openInExcalidraw()" id="open-btn" disabled>üé® –û—Ç–∫—Ä—ã—Ç—å –≤ Excalidraw</button>
                    <button class="btn secondary" onclick="downloadJSON()" id="download-btn" disabled>üíæ –°–∫–∞—á–∞—Ç—å —Ñ–∞–π–ª</button>
                </div>
            </div>
        </div>
        
        <div class="info">
            <p>üí° <strong>–°–æ–≤–µ—Ç:</strong> –≠—Ç–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç Mermaid –¥–∏–∞–≥—Ä–∞–º–º—ã –≤ —Ñ–æ—Ä–º–∞—Ç Excalidraw</p>
            <p>üìå –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ <a href="https://mermaid-to-excalidraw.vercel.app/" target="_blank">–æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π –∫–æ–Ω–≤–µ—Ä—Ç–µ—Ä</a> –¥–ª—è –±–æ–ª–µ–µ —Å–ª–æ–∂–Ω—ã—Ö –¥–∏–∞–≥—Ä–∞–º–º</p>
            <p>üé® –û—Ç–∫—Ä–æ–π—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ <a href="https://excalidraw.com/" target="_blank">Excalidraw</a> –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è</p>
            <p>
                <a href="https://github.com/shao3d/Ukido_DynContInj" target="_blank">GitHub</a> ‚Ä¢ 
                <a href="simple-diagrams.html">–ü—Ä–æ—Å—Ç—ã–µ –¥–∏–∞–≥—Ä–∞–º–º—ã</a> ‚Ä¢ 
                <a href="index.html">–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–µ –¥–∏–∞–≥—Ä–∞–º–º—ã</a>
            </p>
        </div>
    </div>
    
    <script>
        // –ü—Ä–µ–¥–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–µ –¥–∏–∞–≥—Ä–∞–º–º—ã Ukido
        const diagrams = {
            architecture: `graph TB
    U[–†–æ–¥–∏—Ç–µ–ª—å]
    API[FastAPI Server<br/>localhost:8000]
    R[Gemini 2.5 Flash<br/>Router<br/>$0.30/1M]
    G[Claude 3.5 Haiku<br/>Generator<br/>$0.25/1M]
    SD[Social Detector<br/>50+ patterns]
    HM[History Manager<br/>10 messages]
    KB[(Documents<br/>9 MD files)]
    
    U -->|POST /chat| API
    API --> R
    R --> SD
    R --> HM
    R --> KB
    R --> G
    G --> API
    API --> U`,
            
            sequence: `sequenceDiagram
    participant U as –†–æ–¥–∏—Ç–µ–ª—å
    participant API as FastAPI
    participant R as Gemini Router
    participant G as Claude Generator
    participant DB as Knowledge Base

    U->>API: POST /chat
    API->>R: Process message
    R->>DB: Search docs
    DB-->>R: Return docs
    R-->>API: RouterResponse
    API->>G: Generate
    G-->>API: Response
    API-->>U: JSON`,
            
            flow: `flowchart TD
    Start([User Message]) --> Check{Check Type}
    Check -->|Social| Social[Quick Response]
    Check -->|Business| Router[Send to Router]
    Social --> Return([Return])
    Router --> Classify{Classify}
    Classify -->|Success| Generate[Claude Generate]
    Classify -->|Offtopic| Template[Template]
    Generate --> Return
    Template --> Return`,
            
            pie: `pie title –¢–∏–ø—ã –∑–∞–ø—Ä–æ—Å–æ–≤
    "–ö—É—Ä—Å—ã" : 35
    "–¶–µ–Ω—ã" : 25
    "–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ" : 15
    "–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª–∏" : 10
    "–°–æ—Ü–∏–∞–ª—å–Ω—ã–µ" : 10
    "Offtopic" : 5`
        };
        
        let currentExcalidrawData = null;
        
        function loadDiagram(type) {
            document.getElementById('mermaid-input').value = diagrams[type];
            showStatus('info', `–ó–∞–≥—Ä—É–∂–µ–Ω–∞ –¥–∏–∞–≥—Ä–∞–º–º–∞: ${type}`);
        }
        
        function clearInput() {
            document.getElementById('mermaid-input').value = '';
            document.getElementById('excalidraw-output').innerHTML = '<p style="color: #999; text-align: center; margin-top: 150px;">–†–µ–∑—É–ª—å—Ç–∞—Ç –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ –ø–æ—è–≤–∏—Ç—Å—è –∑–¥–µ—Å—å...</p>';
            currentExcalidrawData = null;
            updateButtons(false);
            hideStatus();
        }
        
        function convertToExcalidraw() {
            const mermaidCode = document.getElementById('mermaid-input').value.trim();
            
            if (!mermaidCode) {
                showStatus('error', '–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ Mermaid –∫–æ–¥');
                return;
            }
            
            // –°–æ–∑–¥–∞–µ–º –±–∞–∑–æ–≤—ã–π Excalidraw —Ñ–æ—Ä–º–∞—Ç
            // –≠—Ç–æ —É–ø—Ä–æ—â–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è - –¥–ª—è –ø–æ–ª–Ω–æ–π –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ –Ω—É–∂–µ–Ω —Å–µ—Ä–≤–µ—Ä–Ω—ã–π API
            const excalidrawData = {
                type: "excalidraw",
                version: 2,
                source: "https://excalidraw.com",
                elements: [],
                appState: {
                    gridSize: null,
                    viewBackgroundColor: "#ffffff"
                },
                files: {}
            };
            
            // –ü—Ä–æ—Å—Ç–æ–π –ø–∞—Ä—Å–µ—Ä –¥–ª—è –±–∞–∑–æ–≤—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
            // –í —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏ –Ω—É–∂–µ–Ω –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π –ø–∞—Ä—Å–µ—Ä Mermaid
            const lines = mermaidCode.split('\n');
            let y = 50;
            
            lines.forEach((line, index) => {
                // –ò—â–µ–º —É–∑–ª—ã –≤ —Ñ–æ—Ä–º–∞—Ç–µ ID[Label]
                const nodeMatch = line.match(/(\w+)\[(.*?)\]/);
                if (nodeMatch) {
                    const [, id, label] = nodeMatch;
                    excalidrawData.elements.push({
                        type: "rectangle",
                        version: 1,
                        versionNonce: Math.floor(Math.random() * 1000000),
                        isDeleted: false,
                        id: id,
                        fillStyle: "hachure",
                        strokeWidth: 1,
                        strokeStyle: "solid",
                        roughness: 1,
                        opacity: 100,
                        angle: 0,
                        x: 100 + (index % 3) * 200,
                        y: y,
                        strokeColor: "#000000",
                        backgroundColor: "#ffc9c9",
                        width: 150,
                        height: 60,
                        seed: Math.floor(Math.random() * 1000000),
                        groupIds: [],
                        boundElements: [],
                        locked: false,
                        link: null,
                        updated: Date.now()
                    });
                    
                    // –î–æ–±–∞–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç
                    excalidrawData.elements.push({
                        type: "text",
                        version: 1,
                        versionNonce: Math.floor(Math.random() * 1000000),
                        isDeleted: false,
                        id: id + "_text",
                        fillStyle: "hachure",
                        strokeWidth: 1,
                        strokeStyle: "solid",
                        roughness: 1,
                        opacity: 100,
                        angle: 0,
                        x: 110 + (index % 3) * 200,
                        y: y + 20,
                        strokeColor: "#000000",
                        backgroundColor: "transparent",
                        width: 130,
                        height: 20,
                        seed: Math.floor(Math.random() * 1000000),
                        groupIds: [],
                        boundElements: [],
                        locked: false,
                        fontSize: 16,
                        fontFamily: 1,
                        text: label.replace(/<br\/>/g, '\n'),
                        baseline: 18,
                        textAlign: "center",
                        verticalAlign: "middle",
                        containerId: id,
                        originalText: label,
                        updated: Date.now()
                    });
                    
                    if (index % 3 === 2) y += 100;
                }
            });
            
            currentExcalidrawData = excalidrawData;
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
            const outputDiv = document.getElementById('excalidraw-output');
            outputDiv.innerHTML = `<pre style="font-size: 12px; overflow: auto; max-height: 400px;">${JSON.stringify(excalidrawData, null, 2)}</pre>`;
            
            updateButtons(true);
            showStatus('success', '‚úÖ –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞! –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫–∏ –Ω–∏–∂–µ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º.');
        }
        
        function copyToClipboard() {
            if (!currentExcalidrawData) return;
            
            navigator.clipboard.writeText(JSON.stringify(currentExcalidrawData, null, 2))
                .then(() => {
                    showStatus('success', 'üìã JSON —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞!');
                })
                .catch(err => {
                    showStatus('error', '–û—à–∏–±–∫–∞ –ø—Ä–∏ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–∏: ' + err);
                });
        }
        
        function openInExcalidraw() {
            if (!currentExcalidrawData) return;
            
            // –°–æ–∑–¥–∞–µ–º URL —Å –¥–∞–Ω–Ω—ã–º–∏
            const data = encodeURIComponent(JSON.stringify(currentExcalidrawData));
            
            // –û—Ç–∫—Ä—ã–≤–∞–µ–º Excalidraw (–∫ —Å–æ–∂–∞–ª–µ–Ω–∏—é, –ø—Ä—è–º–æ–π –∏–º–ø–æ—Ä—Ç —á–µ—Ä–µ–∑ URL –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è)
            // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –ø—Ä–∏–¥–µ—Ç—Å—è –≤—Ä—É—á–Ω—É—é –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å JSON
            showStatus('info', 'üé® –û—Ç–∫—Ä–æ–π—Ç–µ Excalidraw –∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ File ‚Üí Open –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ JSON');
            
            // –°–Ω–∞—á–∞–ª–∞ –∫–æ–ø–∏—Ä—É–µ–º –≤ –±—É—Ñ–µ—Ä
            copyToClipboard();
            
            // –ó–∞—Ç–µ–º –æ—Ç–∫—Ä—ã–≤–∞–µ–º Excalidraw
            setTimeout(() => {
                window.open('https://excalidraw.com/', '_blank');
            }, 1000);
        }
        
        function downloadJSON() {
            if (!currentExcalidrawData) return;
            
            const dataStr = JSON.stringify(currentExcalidrawData, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportFileDefaultName = 'ukido-diagram.excalidraw';
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
            
            showStatus('success', 'üíæ –§–∞–π–ª –∑–∞–≥—Ä—É–∂–µ–Ω!');
        }
        
        function updateButtons(enabled) {
            document.getElementById('copy-btn').disabled = !enabled;
            document.getElementById('open-btn').disabled = !enabled;
            document.getElementById('download-btn').disabled = !enabled;
        }
        
        function showStatus(type, message) {
            const statusDiv = document.getElementById('status-message');
            statusDiv.className = 'status ' + type;
            statusDiv.textContent = message;
            statusDiv.style.display = 'block';
            
            if (type !== 'error') {
                setTimeout(hideStatus, 3000);
            }
        }
        
        function hideStatus() {
            const statusDiv = document.getElementById('status-message');
            statusDiv.style.display = 'none';
        }
    </script>
</body>
</html>